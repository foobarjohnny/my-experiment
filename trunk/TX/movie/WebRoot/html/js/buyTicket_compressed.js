function saveBuyTicketUsedHeight(a){sessionStorage.setItem("SESSION_STORAGE_USED_HEIGHT",a)}function getBuyTicketUsedHeight(){return sessionStorage.getItem("SESSION_STORAGE_USED_HEIGHT")}
function changeBuyButtonCSS(a){var b=0;if(!a){b=getBuyTicketUsedHeight();if(null==b)b=0}if(b==0||a){b=$("#bottomPartDiv").outerHeight();a=$("#titleBarDiv").outerHeight()+$("#infoBarDiv").outerHeight()+$("#blankBarDiv").outerHeight();var c;c=$("#ticketQuantityGroup").css("display")=="block"?$("#ticketQuantityGroup").outerHeight():0;b=a+b+c;saveBuyTicketUsedHeight(b)}a=document.body.clientHeight;c="0";if(a>b)c=a-b;$("#bottomPartDiv").css("top",c+"px")}
function placeAnOrder(){SDKAPI.getSSOToken(getOrderId)}function fetchPriceInfo(){SDKAPI.getSSOToken(fetchPrices)}
function getOrderId(a){var b=$("#email").val();if(!b||b=="")CommonUtil.showAlert("",I18NHelper["email.empty"],I18NHelper["button.ok"]);else if(CommonUtil.emailAddressCheck(b)){setConfirmEmailCache(b);var c=trunkShowTime(getMovieTime()),d=getSearchDateTextColon(),f=JSON.parse(getCurrentSchedule()).ticketURI,e=getSearchQueryForGetTickets(f,d,c);f=e.movieId;e=e.theaterId;var g=$("#totalAmountHidden").val();b=new BookingTicketInfoItem(ticketList,e,f,d,c,b,g);JSON.stringify(b);a={loadingStyle:1,url:GLOBAL_hostUrl+
"BookTicket.do?jsonStr="+JSON.stringify(b)+"&ssoToken="+a,onSuccess:ajaxCallBackOrderId};CommonUtil.ajax(a)}else CommonUtil.showAlert("",I18NHelper["email.invalid"],I18NHelper["button.ok"])}function ajaxCallBackOrderId(a){if(CommonUtil.isEmptyStr(a))CommonUtil.showAlert("",I18NHelper["buyticket.bookingFailed"],I18NHelper["button.ok"]);else{CommonUtil.debug("bookingId:"+JSON.stringify(a));fireCheckout(a)}}
function fetchPrices(a){var b=JSON.parse(getCurrentSchedule()).ticketURI;if(CommonUtil.isEmptyStr(b))CommonUtil.showAlert("",I18NHelper["buyticket.noticket"],I18NHelper["button.ok"],"SDKAPI.goBack(false)");else{var c=trunkShowTime(getMovieTime()),d=getSearchDateTextColon();b=getSearchQueryForGetTickets(b,d,c);a=GLOBAL_hostUrl+"GetTicketQuantity.do?jsonStr="+JSON.stringify(b)+"&ssoToken="+a;CommonUtil.debug("[get Ticket URL] "+a);CommonUtil.ajax({loadingStyle:1,url:a,onSuccess:ajaxCallBackPrices})}}
function ajaxCallBackPrices(a){$("#convenienceFeeHidden").val(a.convenienceCharge);$("#surchargeHidden").val(a.surcharge);$("#surcharge").html("$"+formatNumber(a.surcharge,2));$("#convenienceFee").html("$"+formatNumber(0,2));$("#surcharge").html("$"+formatNumber(0,2));a=a.ticketList;var b=0,c;for(c in a){var d=new TicketItem(a[c].ticketId,a[c].type,a[c].price,a[c].currency,a[c].quantity);ticketList[b]=d;totalList[b]=0;b+=1}displayTicketData();changeHtml();changeBuyButtonCSS(true)}
function add(a){ticketList[a].quantity+=1;ticketList[a].quantity>0&&$("#subImg"+a).attr("class","clsPlusSubIcon clsSubtractIconUnfocused");totalList[a]=ticketList[a].quantity*ticketList[a].price*100/100;changeHtml()}function sub(a){if(ticketList[a].quantity>0){ticketList[a].quantity-=1;ticketList[a].quantity<=0&&$("#subImg"+a).attr("class","clsPlusSubIcon clsSubtractIconDisabled");totalList[a]=ticketList[a].quantity*ticketList[a].price*100/100;changeHtml()}}
function changeHtml(){var a=0,b=0,c=0;for(b=c=0;b<ticketList.length;b++){document.getElementById("quantityOf_"+b).innerHTML=ticketList[b].quantity;document.getElementById("totalOf_"+b).innerHTML="$"+formatNumber(totalList[b],2);a+=totalList[b];c+=ticketList[b].quantity}if(formatNumber(a,2)==formatNumber(0,2)){$("#buyButton").attr("disabled","disabled");$("#buyButton").attr("class","ticketBuyButton ticketBuyButtonDisabledBg");$("#buyButton").attr("ontouchstart","");$("#buyButton").attr("ontouchend",
"");$("#buyButton").attr("ontouchmove","")}else{buyButton.disabled=false;$("#buyButton").attr("class","ticketBuyButton clsFontColor_unfocusedBuyBT clsSmallRadius clsButtonBgNormal");$("#buyButton").attr("ontouchstart","hightLightBuyButton(this)");$("#buyButton").attr("ontouchend","disHightLightBuyButton(this)");$("#buyButton").attr("ontouchmove","disHightLightBuyButton(this)")}b=$("#surchargeHidden").val()*100*c/100;c=$("#convenienceFeeHidden").val()*100*c/100;a+=b*100/100;a+=c*100/100;document.getElementById("totalMoney").innerHTML=
"$"+formatNumber(a,2);document.getElementById("convenienceFee").innerHTML="$"+formatNumber(c,2);document.getElementById("surcharge").innerHTML="$"+formatNumber(b,2);$("#totalAmountHidden").val(a)}function hightLightBuyButton(a){highlightBtnAll(a,"clsFontColor_unfocusedBuyBT","clsFontColor_focusedBuyBT")}function disHightLightBuyButton(a){disHighlightBtnAll(a,"clsFontColor_focusedBuyBT","clsFontColor_unfocusedBuyBT")}
function formatNumber(a,b){if(b<1)return a;var c=a.toString();return c.indexOf(".")!=-1?c.split(".")[1].length>=b?c:formatNumber(c+"0",b):formatNumber(c+".0",b)}
function showMovieInfo(){var a=JSON.parse(getCurrentMovie());document.getElementById("movieName").innerText=a.name;a=JSON.parse(getCurrentTheater());document.getElementById("address").innerHTML=a.addressDisplay;document.getElementById("theaterName").innerText=a.name;JSON.parse(getCurrentSchedule());a=getMovieTime();document.getElementById("time").innerHTML="&nbsp;&nbsp;&nbsp;"+convertTimeFormatToDisplay(a);a=getScheduleDate();document.getElementById("date").innerHTML=a.format("mmm d, yyyy");(a=getConfirmEmailCache())&&
$("#email").val(a)}function getRequest(){var a=location.search,b={};if(a.indexOf("?")!=-1){strs=a.substr(1).split("&");for(a=0;a<strs.length;a++)b[strs[a].split("=")[0]]=unescape(strs[a].split("=")[1])}return b}function TicketItem(a,b,c,d){this.id=a;this.type=b;this.price=c;this.currency=d;this.quantity=0}function BookingTicketInfoItem(a,b,c,d,f,e,g){this.ticketArray=a;this.theaterId=b;this.movieId=c;this.showDate=d;this.showTime=f;this.confirmEmail=e;this.totalAmount=g}
function trunkShowTime(a){a=a.split(":");return a[0]+":"+a[1]}function getSearchQueryForGetTickets(a,b,c){var d,f;if(!a||a=="")return null;if(a.indexOf("?")==-1)return null;a=a.substring(a.indexOf("?")+1,a.length).split("&");if(a.length!=3)return null;for(i=0;i<a.length;i++){var e=a[i].split("=");if(e[0]=="m")d=e[1];else if(e[0]=="t")f=e[1]}return{movieId:d,theaterId:f,showDate:b,showTime:c}}
function isFlip(){var a=document.documentElement.clientWidth;if(GLOBAL_currentWidth==a)return false;else{GLOBAL_currentWidth=a;return true}}function fireCheckout(a){CommonUtil.debug("orderId:"+a);PassThrough.checkout(a,I18NHelper["checkout.purchaseFor"]+" "+$("#movieName").html(),function(b){displayConfirmation(b)})}function displayConfirmation(a){$("#ticketQuantityGroup").hide();$("#bottom").hide();a=a.bookingResult;$("#bookingInfoDiv").show();$("#bookingInfoDiv").html(a)}
function displayTicketData(){var a="";if(ticketList.length<=0)CommonUtil.showAlert("",I18NHelper["buyticket.noticket.schedule"],I18NHelper["button.ok"],"SDKAPI.goBack(false)");else{for(var b=0;b<ticketList.length;b++){var c="";c=ticketList.length==1?"clsticketitembg":b==0?"clsticketitembgtop":ticketList.length==1+b?"clsticketitembgbottom":"clsticketitembgmiddle";a+='<div id="ticketQuantityResult" class=\'div_table '+c+" '><div style='width: 5%;' class='div_cell ticketquantityrightstyle' onClick=\"sub('"+
b+"')\"><div id='subImg"+b+"' class='clsPlusSubIcon clsSubtractIconDisabled'></div></div><div style='width: 8%;' id='quantityOf_"+b+"' class='div_cell ticketquantitycenterstyle fs_middle' ></div><div style='width: 10%;' class='div_cell' onClick=\"add("+b+")\"><div class='clsPlusSubIcon clsPlusIconUnfocused'></div></div><div style='width: 40%; text-align: left;' class='div_cell ticketquantitystyle fs_middle'>"+ticketList[b].type+"<br/><span class='clsPrompt fs_small'>($"+ticketList[b].price+")</span></div><div style='width: 25%; text-align: right;'  id='totalOf_"+
b+"' class='div_cell ticketquantitystyle fs_middle'></div></div>"}a+=$("#ticketQuantitySubDiv").html();$("#ticketQuantitySubDiv").html(a);$("#ticketQuantityGroup").css("display","block")}}function APPSTORE_API_lockScreen(){PopupUtil.showLoading()}function APPSTORE_API_unLockScreen(){PopupUtil.hide()};
