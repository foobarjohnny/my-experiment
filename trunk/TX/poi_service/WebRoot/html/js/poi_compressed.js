var MisLogConstants={EVENT_ID_POI_VIEW_DETAIL:701,EVENT_ID_POI_VIEW_MAP:702,EVENT_ID_POI_DRIVE_TO:703,EVENT_ID_POI_CALL_TO:704,EVENT_ID_POI_VIEW_MERCHANT:705,EVENT_ID_POI_VIEW_COUPON:706,EVENT_ID_POI_VIEW_MENU:707,EVENT_ID_POI_VIEW_REVIEW:760,EVENT_ID_PROVIDER_REVIEW_IMPRESSION:761,EVENT_ID_PROVIDER_REVIEW_CLICK:762};function recordMisLog_ViewReview(){recordMisLogOfPoi(MisLogConstants.EVENT_ID_POI_VIEW_REVIEW)}
function recordMisLog_Provider_Impression(a,b){var c=getMisLogJson();c["70050"]=b;c["70051"]=a;SDKAPI.logEvent(MisLogConstants.EVENT_ID_PROVIDER_REVIEW_IMPRESSION,c)}function recordMisLog_Provider_Click(a,b){var c=getMisLogJson();c["70050"]=b;c["70051"]=a;SDKAPI.logEvent(MisLogConstants.EVENT_ID_PROVIDER_REVIEW_CLICK,c)}function recordMisLog_ViewDetail(){}function recordMisLog_ViewMap(){}function recordMisLog_DriveTo(){recordMisLogOfPoi(MisLogConstants.EVENT_ID_POI_DRIVE_TO)}
function recordMisLog_CallTo(){recordMisLogOfPoi(MisLogConstants.EVENT_ID_POI_CALL_TO)}function recordMisLog_ViewMerchantContent(){CommonUtil.isIphone()&&recordMisLogOfPoi(MisLogConstants.EVENT_ID_POI_VIEW_MERCHANT)}function recordMisLog_ViewCoupon(){recordMisLogOfPoi(MisLogConstants.EVENT_ID_POI_VIEW_COUPON)}function recordMisLog_ViewMenu(){recordMisLogOfPoi(MisLogConstants.EVENT_ID_POI_VIEW_MENU)}function recordMisLogOfPoi(a){SDKAPI.logEvent(a,getMisLogJson())}
function getMisLogJson(){var a=(new Date).getTime(),b=$("#poikey").val();a={"10003":a,"-10001":b};if(CommonUtil.isIphone()){b=getPoiDetailObj();a["70001"]=b.poi.bizPoi.poiId;a["70002"]=CommonUtil.getValidString(b.poi.adsId)}return a};function ResourceLazyLoader(){}
ResourceLazyLoader.prototype={jsNo:0,cssNo:0,currentJSLoaded:0,isCssAllLoaded:true,callBackAfterResourceLoaded:null,lazyLoadResource:function(a,b,c){this.callBackAfterResourceLoaded=c;c=document.getElementsByTagName("HEAD").item(0);var d=this;if(a){this.jsNo=a.length;for(var e=0;e<this.jsNo;e++){var f=document.createElement("script");f.type="text/javascript";f.src=GLOBAL_contextPath+a[e];var h=a[e];f.onload=function(){d.onOneJSLoaded(h)};c.appendChild(f)}}if(b){this.cssNo=b.length;for(e=0;e<this.cssNo;e++){a=
document.createElement("link");a.type="text/css";a.href=GLOBAL_cssUrl+b[e];a.rel="stylesheet";c.appendChild(a)}var g=document.styleSheets.length,i=setInterval(function(){if(document.styleSheets.length>=g+d.cssNo){console.log("Hotel CSS loaded");d.onAllCssLoaded();clearInterval(i)}},300)}},onOneJSLoaded:function(a){this.currentJSLoaded++;CommonUtil.debug("javaScript: [ "+a+" ] successfully loaded");this.checkAllResource()},onAllCssLoaded:function(){this.isCssAllLoaded=true;console.log("All CSS successfully loaded");
this.checkAllResource()},checkAllResource:function(){this.isCssAllLoaded&&this.currentJSLoaded>=this.jsNo&&this.callBackAfterResourceLoaded.call(this)}};var LazyLoader=new ResourceLazyLoader;function initPhoneGap(){document.addEventListener("deviceready",onDeviceReady,false)}function onDeviceReady(){if(""!=CommonUtil.getValidString(PoiCacheHelper.getReviewStatus()))initPoiDetailData();else{fetchPoiKey();getPoiDataFromClient();clearPoiDetailHistory()}}function fetchPoiKey(){try{var a=window.TempCache;if(a!=null){var b=CommonUtil.getValidString(a.getCacheValue("poikey"));if(""!=b)document.getElementById("poikey").value=b}}catch(c){}}
function clearPoiDetailHistory(){var a={poikey:$("#poikey").val()};SDKAPI.invokePrivateService("clearHistory",a)}function getPoiDataFromClient(){var a={poikey:$("#poikey").val()};SDKAPI.invokePrivateService("RetrieveCurrentAddress",a,preparePoiDetailData)}function initDummyData(){""!=CommonUtil.getValidString(PoiCacheHelper.getReviewStatus())?initPoiDetailData():preparePoiDetailData(PoiCacheHelper.getDummyPoiDetail())}
function getPoiDetailObj(){return JSON.parse(CommonUtil.getFromCache(appendPoiKey(PoiCacheKeys.POIDETAIL)))}function shareAddress(){var a=getPoiDetailObj();PoiCommonHelper.hasValidPoiAddress(a)&&SDKAPI.invokePrivateService("ShareAddress",a)}function searchNearBy(){var a=getPoiDetailObj();PoiCommonHelper.hasValidPoiAddress(a)&&SDKAPI.invokePrivateService("SearchNearBy",a)}function appendPoiKey(a){return a+"_"+$("#poikey").val()}
function preparePoiDetailData(a){CommonUtil.debug("poi data:"+a);recordMisLog_ViewDetail();CommonUtil.saveInCache(appendPoiKey(PoiCacheKeys.POIDETAIL),unescape(a));initPoiDetailData()}function initPoiDetailData(){hideAll();var a=getPoiDetailObj();initTopPart(a);PoiDetailSpecificHelper.initTab(a)}
function clearPoiCache(){CommonUtil.removeCache(appendPoiKey(PoiCacheKeys.REVIEWDATA));PoiCacheHelper.removePoiMainCache();PoiCacheHelper.removePoiExtraCache();PoiCacheHelper.removePoiMenuCache();PoiCacheHelper.removePoiDealCache();PoiCacheHelper.removeMapFlagCache();PoiCacheHelper.removeBizHourFlagCache();PoiCacheHelper.removeGasByPriceCache()}
function initTopPart(a){var b=a.poi,c=b.bizPoi;$("#name").html(CommonUtil.toHtmlString(c.brand));$("#distance").html(formatDisUnit(c.distanceWithUnit));if(PoiCommonHelper.hasValidPoiAddress(a))if(a.existedInFavorite){$("#favIndicator").attr("class","favorites_add_button_unfocused");$("#favHref").attr("onClick","")}else{$("#favIndicator").attr("class","favorites_button_unfocused");$("#favHref").attr("onClick","PoiCommonHelper.saveFavToClient()")}else $("#favIndicator").hide();PoiCommonHelper.setPoiAddressDisplay(a.stop);
PoiCommonHelper.setPhoneNo();displayReviewNumber(b.rateNumber);diplayRatingIcon("ratingIcons",b.rating,"small");diplayRatingIcon("ratingIconsLandscape",b.rating,"small");PoiDetailSpecificHelper.getTopPartLogoImage(b)}function formatDisUnit(a){if(a){var b=a.split(" ");if(b.length>=2){var c=CommonUtil.getValidString(b.shift());if(c.length<=4||c.indexOf(".")<0)return a;a=c.indexOf(".");c=a>=3?c.substring(0,a):c.substring(0,4);return c+" "+b.shift()}else return a}else return a}
function displayReviewNumber(a){var b="<div class='clsRateNoFS'><b>"+a+"</b><br><div class='reviewText'>";b+=a>1?I18NHelper["poidetail.reviews"]:I18NHelper["poidetail.review"];b+="</div></div>";$("#ratingNumber").html(b);$("#ratingNumberLandscape").html(b)}function displayEmptyLogo(){var a;$("#logImageDiv").html("<img class='clsLogoImageDiv' src='"+GLOBAL_imageCommonUrl+"poi_details_default_logo_unfocused.png'/>")}
function displayLogoImage(a){$("#logImageDiv").html('<image class="clsLogoImageDiv" id="{0}" src="{1}" />'.format("logImage","data:image/gif;base64,"+a))}
function displayPriceRangeIcons(a){a=parseInt(a);a>0&&$("#priceRange").show();document.getElementById("priceRange1").className=getPriceClass(a);document.getElementById("priceRange2").className=getPriceClass(a-1);document.getElementById("priceRange3").className=getPriceClass(a-2);document.getElementById("priceRange4").className=getPriceClass(a-3)}function getPriceClass(a){var b="clsDollarGrey fs_middle";if(a>0)b="clsDollarOrange fs_middle";return b}
function showpoiopentablemain(){OpenTable.showOpenTableMain()}function showpoireview(){""==CommonUtil.getValidString(CommonUtil.getFromCache(appendPoiKey(PoiCacheKeys.REVIEWDATA)))?PoiFetchDataHelper.fetchReviewData():displayReview()}function reviewNum2ReviewImg(a){return a>0?"<img class='evaluation good_icon_unfocused'  />":"<img class='evaluation bad_icon_unfocused'  />"}
function displayReview(){recordMisLog_ViewReview();var a=JSON.parse(CommonUtil.getFromCache(appendPoiKey(PoiCacheKeys.REVIEWDATA)));PoiCacheHelper.setPoiReviewOptionCache(a.reviewOptions);diplayRatingIcon("reviewRatingIcon",a.rating,"big");var b=I18NHelper["poidetail.review"];if(a.rateNumber>1)b=I18NHelper["poidetail.reviews"];var c="("+a.rateNumber+" "+b+")";$("#reviewRatingNum").html(c);displayReviewNumber(a.rateNumber);diplayRatingIcon("ratingIcons",a.rating,"small");diplayRatingIcon("ratingIconsLandscape",
a.rating,"small");var d="<div class='div_table'><div class='div_row'>",e=a.ratingPropertiesStatistic,f=e.length,h="100%";if(f!=0)h=100/f+"%";for(c=0;c<f;c++){var g=e[c],i=g.value,j=g.count;d+="<div class='div_cell' style='width:"+h+"'><div class='div_table clsFixTable'><div class='div_row'> <div class='div_cell fs_small fc_gray fw_bold align_center'>"+g.name+"</div></div><div class='div_row'> <div class='div_cell align_center' id='valueImage'>";d+=reviewNum2ReviewImg(i);d+="</div></div>";d+="<div class='div_row'> <div class='div_cel fs_small fc_gray align_center'>"+
j+" "+I18NHelper["review.user"]+"</div></div>";d+="</div></div>";if(c!=f-1&&!CommonUtil.isScoutStyle())d+="<div class='div_cell bgImgH'>&nbsp;</div>"}d+="</div></div>";$("#reviewOptionStatistic").html(d);f>0?$("#reviewOptionStatistic").show():$("#reviewOptionStatistic").hide();if(c=a.yelp){recordMisLog_Provider_Impression("Yelp","yelp_button");$("#yelp").show();$("#yelpReviewCount").html("("+c.reviewCount+" "+b+")");displayYelpRating(c.avgRating);d=$(".yelp_button");d.attr("yelpPoiId",c.yelpPoiId);
d.click(onClickYelp)}c=a.tripAdvisor;console.log(c);if(c){recordMisLog_Provider_Impression("TripAdvisor","TripAdvisor_button");$("#trip").show();$("#tripReviewCount").html("("+c.reviewCount+" "+b+")");displayTripCircle(c.avgRating);b=$(".trip_button");b.attr("tripId",c.id);b.click(onClickTrip)}a=a.reviewList;b=a.length;d="";for(c=0;c<b;c++){(e=CommonUtil.convertChar(a[c].reviewerName))||(e=I18NHelper["review.anonymous"]);(f=CommonUtil.convertChar(a[c].comments))||(f=I18NHelper["review.no.Comment"]);
d+="<div id='reviewItem"+c+"' class='clsReviewerDiv clsReviewerDivBg' ontouchstart=\"highLightReviewItem("+c+')" ontouchend="disHighLightReviewItem('+c+')" ontouchmove="disHighLightReviewItem('+c+")\" onClick='showReviewerDetail("+c+")'><div class='table' style='height:100%;width:95%;'><div class='tr'><div class='td' style='width:17%;height:100%'><img class='clsImgDefaultPhoto' src='"+GLOBAL_imageCommonUrl+"default_photo_icon_unfocused.png'/></div><div class='td' style='width:83%;height:100%'><div class='table' style='height:100%;width:100%;'><div class='tr'><div class='td valign_top' style='width:60%;height:50%' align='left'><div style='position:relative;height:100%;' class='clsReviewWrapper'><div class='clsNoWrap fs_middle fc_gray fw_bold' id='reviewUserName"+
c+"'>"+e+"</div></div></div><div class='td clsReviewWrapper' style='width:40%' align='right' id='reviewUserRating"+c+"'>"+getRatingIcons(a[c].rating,"medium")+"</div></div><div class='tr'><div class='td valign_top'><div class='clsReviewBottomContentDiv'><div class='clsNoWrap fs_middle fc_gray' align='left' id='reviewUserComments"+c+"'>"+f+"</div></div></div></div></div></div></div></div></div>"}$("#reviewerListDiv").html(d)}
function displayYelpRating(a){for(var b=[["yelp_no_star",0,4],["yelp_one_star",5,10],["yelp_one_half_star",11,15],["yelp_two_star",16,20],["yelp_two_half_star",21,25],["yelp_three_star",26,30],["yelp_three_half_star",31,35],["yelp_four_star",36,40],["yelp_four_half_star",41,45],["yelp_five_star",46,1E3]],c=0;c<b.length;c++){var d=b[c];a>=d[1]&&a<=d[2]?$("."+d[0]).show():$("."+d[0]).hide()}}
function displayTripCircle(a){for(var b=[["trip_no_circle",0,2],["trip_half_circle",2,4],["trip_one_circle",5,10],["trip_one_half_circle",11,15],["trip_two_circle",16,20],["trip_two_half_circle",21,25],["trip_three_circle",26,30],["trip_three_half_circle",31,35],["trip_four_circle",36,40],["trip_four_half_circle",41,45],["trip_five_circle",46,1E3]],c=0;c<b.length;c++){var d=b[c];a>=d[1]&&a<=d[2]?$("."+d[0]).show():$("."+d[0]).hide()}}
function onClickYelp(){var a=$(".yelp_button").attr("yelpPoiId"),b=ClientInfo.platform;if("IPHONE"==b||"IPAD"==b){var c=navigator.tnservice;if(c){recordMisLog_Provider_Click("Yelp","yelp_button");c.launchNativeBrowser("yelp:///biz/"+a,function(){},function(){c.launchNativeBrowser("http://www.yelp.com/biz/"+a)})}}else{recordMisLog_Provider_Click("Yelp","yelp_button");window.location="http://www.yelp.com/biz/"+a+"?nativebrowser=true"}}
function onClickTrip(){var a=$(".trip_button").attr("tripId"),b=ClientInfo.platform;if("IPHONE"==b||"IPAD"==b){var c=navigator.tnservice;if(c){recordMisLog_Provider_Click("TripAdvisor","TripAdvisor_button");c.launchNativeBrowser("yelp:///biz/"+a,function(){},function(){c.launchNativeBrowser("http://www.yelp.com/biz/"+yelpId)})}}else{recordMisLog_Provider_Click("TripAdvisor","TripAdvisor_button");window.location="http://www.163.com/biz/"+a+"?nativebrowser=true"}}
function showReviewerDetail(a){PoiCacheHelper.setReviewStatusAsView();a=JSON.parse(CommonUtil.getFromCache(appendPoiKey(PoiCacheKeys.REVIEWDATA))).reviewList[a];PoiCacheHelper.setCurrentReviewer(JSON.stringify(a));location.href=GLOBAL_hostUrl+"goToJsp.do?jsp=viewReview&"+CommonUtil.getClientInfoNormal()}
function loadPopup_poidetail(){var a=CommonUtil.getScreenHeight();if(a==0)CommonUtil.retry(loadPopup_poidetail);else{var b=$("#topPartDiv").height()+$("#middlePartDiv").height();PopupUtil.showPoiLoading(b,a-b)}}function centerPopup_poidetail(){PopupUtil.center()}function getPoiAddress(){return getPoiDetailObj().stop}
function generateSimplePoiData(){var a=getPoiDetailObj(),b=a.poi.bizPoi;CommonUtil.saveInCache(PoiCacheKeys.SIMPLEPOI,JSON.stringify({poiId:b.poiId,brand:b.brand,categoryId:b.categoryId,stop:a.stop}))}function onClickWriteReview(){PoiCacheHelper.setReviewStatusAsView();generateSimplePoiData();PoiCacheHelper.setPoiReviewCacheKeyForAddReview();location.href=GLOBAL_hostUrl+"goToJsp.do?jsp=addReview&"+CommonUtil.getClientInfoNormal()}
function resizeMenuImage(){if($("#menuImage")){$("#menuImage").width(document.documentElement.clientWidth*94/100);$("#menuImage").height(document.documentElement.clientWidth*96/100)}}function setShownTab(a){if(a)PoiCommonHelper.onChangeTab("poidetailtab",1,hasTabNum,"poireview");else PoiCommonHelper.onChangeTab("poidetailtab",0,hasTabNum,"poimain")}function isBackFromViewOrAddReview(){return"VIEW"==CommonUtil.getValidString(PoiCacheHelper.getReviewStatus())}
function initPoiCacheByReviewStatus(a){a?PoiCacheHelper.setReviewStatus(""):clearPoiCache()}function loadResourceAndSetShownTab(a,b){if(b){lazyLoadJsAndCss(a,b);PoiCommonHelper.onChangeTab("poidetailtab",1,hasTabNum,"poireview")}else lazyLoadJsAndCss(a,b)}function hideAll(){$("#poimain").hide();$("#poireview").hide();$("#poideals").hide();$("#poimenu").hide();$("#poitheater").hide();$("#poiextra").hide();$("#poigas").hide()}
function formateMenuText(a){a=a.replace(/<bold>/ig,"<br><b>");return a=a.replace(/<\/bold>/ig,"</b><br>")}
function showpoimain(){$("#poidesc").show();$("#priceRange").hide();$("#mapImageContainer").hide();var a=getPoiDetailObj();if(!a)return false;var b=CommonUtil.getValidString(PoiCacheHelper.getPoiMainCache());if(b){displayPoiMain();a=JSON.parse(b);PoiDetailSpecificHelper.fetchLogoWhenShowMain(a.logoName)}else PoiDetailSpecificHelper.loadPoiMain(a);CommonUtil.debug("SCOUT Feature: "+GLOBAL_FeatureHelper.SCOUTSTYLE);CommonUtil.debug("OPENGL Feature: "+FeatureHelper.OPENGLMAP)}
function displayPoiMain(){var a=CommonUtil.getValidString(PoiCacheHelper.getPoiMainCache());if(a){var b=JSON.parse(a);a=CommonUtil.getValidString(b.description);$("#poidesc").html("<div class='poiContentPadding'>"+a+"</div>");var c=b.businessHours;if(c){PoiCacheHelper.setBizHourFlag("Y");$("#businessHour").html(c);cssHelper.appendObjCSSById("mainTabFirstLine","clsFirstLineBG")}displayPriceRangeIcons(b.priceRange);if(b.isOpen){$("#openFlag").html(I18NHelper["poidetail.open"]);$("#openFlag").attr("class",
"td clsOpenFlag fs_large fw_bold")}else if(c){$("#openFlag").html(I18NHelper["poidetail.close"]);$("#openFlag").attr("class","td clsOpenFlagGrayStyle fs_large fw_bold")}$("#fullBusinessHours").html("<div class='poiContentPadding'>"+b.fullBusinessHours+"</div>");if(b=b.adSource){PoiCacheHelper.setBizHourFlag("Y");b=PoiCommonHelper.getAdSourceImageClass(b);$("#adSource").html('<image class="{1}" id="{0}"/>'.format("adSourceImage",b))}else $("#adSource").hide();if(a){Global_openGLParam.needMap=false;
recordMisLog_ViewMerchantContent()}else{Global_openGLParam.needMap=true;displayMapImage()}PoiCacheHelper.getBizHourFlag()!="Y"&&cssHelper.replaceObjCSSById("mainTabFirstLine","clsMainTabFirstLine","clsMainTabFirstLineEmpty")}}
function switchBizHour(){if(document.getElementById("fullBusinessHours").style.display=="none"){var a=CommonUtil.getValidString(PoiCacheHelper.getPoiMainCache());if(a){a=JSON.parse(a);if(CommonUtil.getValidString(a.fullBusinessHours)){$("#poidetailDesc").hide();$("#fullBusinessHours").show()}}}else{$("#poidetailDesc").show();$("#fullBusinessHours").hide()}}function showpoiextra(){PoiCacheHelper.getPoiExtraCache()?displayPoiExtra():PoiFetchDataHelper.fetchPoiExtra()}
function poihotelmain(){poiId=getPoiDetailObj().poi.bizPoi.poiId;fetchAndDispalyHotelDetail(poiId)}function displayPoiExtra(){var a="",b=CommonUtil.getValidString(PoiCacheHelper.getPoiExtraCache());if(b){b=JSON.parse(b);b=JSON.parse(b.extra);for(var c=b.length,d=0;d<c;d++)a+=getExtraDiv(b[d].key,b[d].value);c==0?noRecordFoundForExtra():$("#poiextra").html(a)}}
function getExtraDiv(a,b){var c="<div class='clsExtraItemDiv'><div class='clsDealTitleDiv fs_large fw_bold fc_black'>"+a+"</div><div class='clsDealInfoDiv fs_small fc_gray'>"+b+"</div>";c+="</div>";return c}function noRecordFoundForExtra(){var a=getExtraDiv("",I18NHelper["poidetail.dataUnavailable"]);$("#poiextra").html(a)}function showpoideals(){PoiCommonHelper.showpoideals()}
function showpoimenu(){PoiCacheHelper.getPoiMenuCache()?PoiCommonHelper.displayPoiMenu():PoiFetchDataHelper.fetchMenuData()}function getPoiSearchKey(){var a=getPoiDetailObj(),b=a.poi.bizPoi;return{poiId:b.poiId,categoryId:b.categoryId,adsId:CommonUtil.getValidString(a.poi.adsId),width:0,height:0,menuWidth:0,menuHeight:0}}
function displayGasByPrice(){var a="",b=CommonUtil.getValidString(PoiCacheHelper.getGasByPriceCache());b=JSON.parse(b);if(b.success){b=JSON.parse(b.data);for(var c="",d="",e=0;e<b.length;e++){c=b[e].name;d="fc_gasName";if(null!=I18NHelper[c])c=I18NHelper[c];a+="<div class='gasItem'><div class='div_table'><div class='tr'><div class='td' style='width:10%'></div><div class='td' style='width:40%' align='left'><div class='clsGasPriceDiv fs_veryLarge "+d+" fw_bold'>"+c+"</div></div><div class='td' style='width:40%' align='right'><div class='clsGasPriceDiv fs_veryLarge fc_gasPrice fw_bold'>"+
b[e].price+"</div></div><div class='td' style='width:10%'></div></div></div></div>";if(e<b.length-1)a+="<div class='clsGreyLine'></div>"}$("#poigas").html(a)}}function showpoigas(){PoiCacheHelper.getGasByPriceCache()?displayGasByPrice():PoiDetailSpecificHelper.fetchGasByPriceData()}function getActualSize(a){return CommonUtil.isIphone()&&window.devicePixelRatio==2?a*2:a}function showpoitheater(){initMovieShowTimes();fetchMovieListData()}
function highLightReviewItem(a){var b=document.getElementById("reviewItem"+a);switchHightlight(b,"clsReviewerDivBg","clsListBgHighlight");$("#reviewUserName"+a).css("color","white");$("#reviewUserComments"+a).css("color","white")}function disHighLightReviewItem(a){var b=document.getElementById("reviewItem"+a);if(b){switchHightlight(b,"clsListBgHighlight","clsReviewerDivBg");$("#reviewUserName"+a).css("color","#666");$("#reviewUserComments"+a).css("color","#666")}}function clearViewParamter(){}
function applyCss(){var a={position:"absolute",bottom:"0px",top:"0px","-webkit-border-radius":" 0px 0px 5px 5px"};CommonUtil.isIphone()||$("#main").css(a)}function changePageCss(){applyCss();PoiCommonHelper.changePoiDetailCss();PoiCommonHelper.changePhoneNoLayout()}function resizeScreen(){changePageCss();$("#poimain").css("display")!="none"&&switchScreenForMapImage();centerPopup_poidetail()}
function initScreen(){changePageCss();if("true"==document.getElementById("dummyData").value){Global_openGLParam.dummyData=true;initDummyData()}else initPhoneGap();document.getElementById("poikey").focus()}function Poi_Util_throttle(a,b){clearTimeout(GLOBAL_tmid);GLOBAL_tmid=setTimeout(function(){a.call(b)},100)}
function lazyLoadJsAndCss(a,b){if(a=="poitheater"){var c=[];c.push("js/movie_Compressed.js");if(!b)PoiCommonHelper.onChangeTab("poidetailtab",0,hasTabNum,"poimain");LazyLoader.lazyLoadResource(c,null,function(){})}else if(!b)PoiCommonHelper.onChangeTab("poidetailtab",0,hasTabNum,"poimain")}
function fetchLogo(a){if(a)if(isExternalLogo(a))$("#logImageDiv").html("<img class='clsLogoImageDiv' src='"+a+"'/>");else{var b=getActualSize($("#logImageDiv").width()),c=getActualSize($("#logImageDiv").height());PoiFetchDataHelper.fetchLogoImage({imageName:a,width:b,height:c})}}function isExternalLogo(a){var b=false;if(a.indexOf("http")==0)b=true;return b}function clickReviewNo(){PoiDetailSpecificHelper.hasReviewTab()&&setShownTab(true)}
function hideTopReviewNo(){$("#topReviewNo").html(" ");$("#topReviewNoLandscape").hide()}function saveFavFlag(){var a=getPoiDetailObj();a.existedInFavorite=true;CommonUtil.saveInCache(appendPoiKey(PoiCacheKeys.POIDETAIL),JSON.stringify(a))}function isOpenGLMap(){return CommonUtil.getBoolean(FeatureHelper.OPENGLMAP)&&!Global_openGLParam.dummyData}function switchScreenForMapImage(){if("Y"==PoiCacheHelper.getMapFlag())isOpenGLMap()?beforeFetchOpenGLMap():displayMapImage()}
function displayMapImage(){$("#poidesc").hide();$("#mapImageContainer").hide();if(!CommonUtil.isLandscape()){var a=CommonUtil.getScreenHeight()-document.getElementById("blackLine").offsetTop-$("#blackLine").height();$("#poimain").height(a)}"Y"==PoiCacheHelper.getBizHourFlag()&&cssHelper.replaceObjCSSById("mainTabFirstLine","clsMainTabFirstLineEmpty","clsMainTabFirstLine");a=getPoiDetailObj();var b=a.stop.lat,c=a.stop.lon;if(b!=0&&c!=0)if(isOpenGLMap())beforeFetchOpenGLMap(a);else{b/=JSConstants.DEGREE_MULTIPLIER;
c/=JSConstants.DEGREE_MULTIPLIER;a=PoiDetailSpecificHelper.getSearchCriteria(b+","+c);fetchMapImage(a)}}var Global_test=0;
function beforeFetchOpenGLMap(){$("#poidesc").hide();$("#mapImageContainer").hide();var a=getPoiDetailObj(),b=a.stop.lat,c=a.stop.lon,d=getMapSize();Global_test++;if(Global_test%2!=0)window.setTimeout(beforeFetchOpenGLMap,200);else{Global_openGLParam.mapSearchCriteria={width:d.width,height:d.height,lat:b,lon:c,zoom:3,poiId:a.poi.bizPoi.poiId,orientation:d.orientation};fetchOpenGLMap()}}
function getMapSize(){var a=document.getElementById("mainInfoTd").offsetHeight,b=document.getElementById("priceRange"),c=document.getElementById("mapBlank2"),d={width:"0",height:"0",orientation:"portrait"},e=0.9,f=$("#openFlag").html()?0.31:0.35;if(CommonUtil.isScoutStyle())e=1;d.width=parseInt(CommonUtil.getScreenWidth()*e);d.height=parseInt(a-b.offsetHeight);if(CommonUtil.isLandscape()){d.height=parseInt(d.width*f);d.orientation="landscape"}else{a=c.offsetTop+c.offsetHeight;b=CommonUtil.getScreenHeight();
if(a<b)d.height=d.height+parseInt(b-a)-2;else if(a>b)d.height-=parseInt(a-b)}if(d.height<100)d.height=100;return d}function fetchMapImage(a){PoiCacheHelper.setMapFlag("Y");a=PoiDetailSpecificHelper.getStaticMapUrl(a);var b=$("#mapImageDiv")[0];if(b.src==a)$("#mapImageContainer").show();else{loadPopup_poidetail();b.src=a;b.onerror=loadStaticMapError;b.onload=loadStaticMapSuccess;PoiDetailSpecificHelper.setMapSize()}}function loadStaticMapError(){PopupUtil.hide()}
function loadStaticMapSuccess(){PopupUtil.hide();$("#mapImageContainer").show()}var Global_openGLParam={needMap:true,mapSearchCriteria:"",dummyData:false,fetchErrMsg:"Deactived"};function fetchOpenGLMap(){PoiCacheHelper.setMapFlag("Y");loadPopup_poidetail();PoiDetailSpecificHelper.setMapSize();navigator.tnservice.getPOIDetailMap(Global_openGLParam.mapSearchCriteria,fetchOpenGLMapCallBack,function(){console.log("getPOIDetailMap error")})}
function fetchOpenGLMapCallBack(a){var b,c="";if(a.return_result.mapdata==undefined)b=CommonUtil.getValidString(a.return_result);else{b=a.return_result.mapdata;c=a.return_result.orientation}if(Global_openGLParam.fetchErrMsg==b||""==b)CommonUtil.debug("can't fetch map");else{CommonUtil.debug("after fetch the map and orientation is:"+c);$("#mapImageDiv").attr("src","data:image/gif;base64,"+b);$("#mapImageContainer").show()}PopupUtil.hide()};function getRatingIcons(a,b){var c="";c+="<img class='"+getRatingIconName(a,b)+"'/>";c+="<img class='"+getRatingIconName(a-10,b)+"'/>";c+="<img class='"+getRatingIconName(a-20,b)+"'/>";c+="<img class='"+getRatingIconName(a-30,b)+"'/>";c+="<img class='"+getRatingIconName(a-40,b)+"'/>";return c}function getRatingIconName(a,b){var c="vacancy_",d="full_";c+=b+"_star_icon_unfocused";d+=b+"_star_icon_unfocused";return 0>=a?c:a<10?c:d}function diplayRatingIcon(a,b,c){$("#"+a).html(getRatingIcons(b,c))};
