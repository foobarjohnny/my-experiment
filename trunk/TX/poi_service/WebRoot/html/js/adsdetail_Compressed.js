function getPoiDetailObj(){return JSON.parse(PoiCacheHelper.getAdsDetailCache())}function hideAll(){$("#poimain").hide();$("#poideals").hide();$("#poimenu").hide()}function changePageCss(){PoiCommonHelper.changePoiDetailCss();PoiCommonHelper.changePhoneNoLayout()}function resizeMenuImage(){}function POI_API_isLandscape(){return CommonUtil.isLandscape()}
function fetchAdsDetailData(){cleanAdsCache();var a=PoiCacheHelper.getAdsIdCache();$("#adId").val(a);a={loadingStyle:1,url:GLOBAL_hostUrl+"adsinfo.do?operateType=fetchDetailData&adsId="+a+"&"+CommonUtil.getClientInfo()+"&isDummy="+$("#isDummy").val(),onSuccess:ajaxCallBackFetchAdsDetail};CommonUtil.ajax(a)}
function ajaxCallBackFetchAdsDetail(a){GLOBAL_adsDetailDataReady=true;checkFavStatus();PoiCacheHelper.setAdsDetailCache(a.baisc);PoiCacheHelper.setPoiMainCache(a.mainTab);PoiCacheHelper.setPoiMenuCache(a.menuTab);PoiCacheHelper.setPoiDealCache(a.dealTab);initTopPart();initTabs(a.mainTab)}
function initTopPart(){var a=getPoiDetailObj(),b=a.poi;$("#name").html(b.bizPoi.brand);$("#distance").html(PoiCacheHelper.getDistanceTextCacheForAds());PoiCommonHelper.setPoiAddressDisplay(a.stop);PoiCommonHelper.setPhoneNo();PoiCommonHelper.changePhoneNoLayout();$("#favIndicator").attr("class","favorites_button_unfocused");$("#favHref").attr("onClick","javascript:PoiCommonHelper.saveFavToClient()")}
function cleanAdsCache(){PoiCacheHelper.removeAdsDetailCache();PoiCacheHelper.removePoiMainCache();PoiCacheHelper.removePoiMenuCache();PoiCacheHelper.removePoiDealCache()}
function showpoimain(){var a=CommonUtil.getValidString(PoiCacheHelper.getPoiMainCache());if(""!=a){a=JSON.parse(a);var b=CommonUtil.getValidString(a.description);b=PoiCommonHelper.formatPoiDesc(b);$("#poidesc").html(b);if((b=a.adSource)&&""!=b){var c=PoiCommonHelper.getAdSourceImageClass(b);$("#adSource").html('<image class="{1}" id="{0}"/>'.format("adSourceImage",c))}else $("#adSource").hide();$("#hidAdSource").val(b);$("#poiId").val(a.poiId);$("#poiType").val(a.poiType);fetchLogo(a.logoName)}}
function showpoideals(){PoiCommonHelper.showpoideals()}function showpoimenu(){PoiCommonHelper.displayPoiMenu()}function displayEmptyLogo(){var a;$("#logImageDiv").html("<img class='clsLogoImageDiv' src='"+GLOBAL_imageCommonUrl+"poi_details_default_logo_unfocused.png'/>")}function displayLogoImage(a){$("#logImageDiv").html("<img class='clsLogoImageDiv' src='"+a+"'/>")}function fetchLogo(a){a==""||a==undefined?displayEmptyLogo():displayLogoImage(a)}
function initTabs(a){var b=JSON.parse(a);a=b.hasDeal;b=b.hasPoiMenu;var c=[];PoiCommonHelper.addTab(c,true,I18NHelper["poidetail.tab.main"],"poimain");PoiCommonHelper.addTab(c,a,I18NHelper["poidetail.tab.deals"],"poideals");PoiCommonHelper.addTab(c,b,I18NHelper["poidetail.tab.menu"],"poimenu");PoiCommonHelper.generateTabs(c);PoiCommonHelper.onChangeTab("poidetailtab",0,c.length,"poimain")}function initPhoneGap(){document.addEventListener("deviceready",onDeviceReady,false)}
function onDeviceReady(){GLOBAL_isdeviceReady=true;checkFavStatus()}function checkFavStatus(){isFavReady()&&initFav()}function initFav(){var a=getPoiDetailObj();PoiCommonHelper.isPoiAddressValid(a.stop)&&SDKAPI.invokePrivateService("IsFavoriteAddress",a,setFavFlag)}function setFavFlag(a){if(JSON.parse(a).return_result==true){$("#favIndicator").attr("class","favorites_add_button_unfocused");$("#favHref").attr("onClick","")}}
function isFavReady(){if(GLOBAL_adsDetailDataReady&&GLOBAL_isdeviceReady)return true;return false}function getDuration(){return(new Date).getTime()-GLOBAL_enterTime}function recordMisLog_DriveTo(){recordMisLog_Poi_View_End(MisLogConstants.EXIT_REASON_DRIVE_TO,getDuration());recordMisLog_DriveTo_internal()}function recordMisLog_ViewMap(){recordMisLog_Poi_View_End(MisLogConstants.EXIT_REASON_MAP,getDuration());recordMisLog_ViewMap_internal()}function saveFavFlag(){};function PoiCommon(){}
PoiCommon.prototype={saveFavToClient:function(){var a=getPoiDetailObj();this.hasValidPoiAddress(a)&&SDKAPI.invokePrivateService("SaveToFavoriteDirectly",a,this.saveFavToClientCallBack)},saveFavToClientCallBack:function(){$("#favIndicator").attr("class","favorites_add_button_unfocused");$("#favHref").attr("onClick","");saveFavFlag();var a=document.getElementById("bgDiv");a.style.display="block";window.setTimeout(function(){a.style.display="none"},1250)},onClickDrive:function(a){function b(){a.disabled=false}
function c(){CommonUtil.debug("Failed to start navigation!");a.disabled=false}a.disabled=true;var d=getPoiDetailObj();if(this.hasValidPoiAddress(d)){recordMisLog_DriveTo();navigator.tnservice.navTo("",d,"",b,c)}},showMapOfClient:function(){function a(){}function b(){CommonUtil.debug(I18NHelper["Failed in mapping this place!"])}var c=getPoiDetailObj();if(this.hasValidPoiAddress(c)){recordMisLog_ViewMap();navigator.tnservice.displayMap(c,"",a,b)}},formatPhoneToDisplay:function(a){a=CommonUtil.getValidString(a);
a=$.trim(a);if(""==a)return a;var b=a.length;if(b==11)a=a.substring(1);if(b==10){b=a.substring(0,3);var c=a.substring(3,6);a=a.substring(6);a="("+b+") "+c+"-"+a}return a},onClickPhoneNo:function(){var a=this.getPhoneNo();if(a){recordMisLog_CallTo();location.href="tel:"+a}},hasValidPoiAddress:function(a){return a&&this.isPoiAddressValid(a.stop)},isPoiAddressValid:function(a){return a.lat&&a.lon},changePoiDetailCss:function(){resizeMenuImage()},setPoiAddressDisplay:function(a){var b="";if(this.isPoiAddressValid(a)){if(a.firstLine)b+=
'<div style="width:100%;" class="clsAddressFS clsAddressLineSpan">'+a.firstLine.toUpperCase()+"</div>";b+="<div class='clsCityFS'>";if(a.city)b+=a.city.toUpperCase();if(a.province)b+=", "+a.province.toUpperCase();b+=" "+a.zip+"</div>";$("#mainButtonsBar").css("display","block")}else{if(CommonUtil.isIphone()){b=I18NHelper["common.address.Unavailable"];$("#navImg").hide()}else b=I18NHelper["common.Unavailable"];this.disableButton("navButton")}$("#address").html(b)},disableButton:function(a){$("#"+a).attr("onClick",
"");$("#"+a).attr("ontouchstart","");$("#"+a).attr("ontouchend","");$("#"+a).attr("ontouchmove","");$("#"+a).css("opacity","0.6")},setPhoneNo:function(){CommonUtil.isScoutStyle()&&$("#phoneDivLandscape").html('<div class="td" style="width:20%;"></div><div class="td clsPhonePicContainerLandscape" style="width:60%;vertical-align:middle;" align="center">\t<img id="phonePicCallForScout" class="call_icon_unfocused" /></div><div class="td" style="width:20%;" align="right">\t<img id="phonePicLandscape" class="poi_details_call_icon_unfocused"/></div>');
var a=this.getPhoneNo();if(a){a=PoiCommonHelper.formatPhoneToDisplay(a);$("#phone").html(a);CommonUtil.isIpad()&&ProgramConstants.ATTNAVPROG==ClientInfo.programCode&&$("#phoneDivLandscape").html("<span class='td align_center fs_small fw_bold'>"+a+"</span>")}else{if(CommonUtil.isScoutStyle()){$("#phone").html(I18NHelper["common.phone.Unavailable"]);$("#phonePic").hide();$("#phonePicLandscape").hide()}else $("#phone").html(I18NHelper["common.Unavailable"]);this.disableButton("phoneButton");this.disableButton("phoneButtonLandscape")}},
getPhoneNo:function(){var a=getPoiDetailObj();return a?CommonUtil.getValidString(a.poi.bizPoi.phoneNumber):""},changePhoneNoLayout:function(){if(CommonUtil.isLandscape()){$("#thirdLineDivLandscape").show();$("#thirdLineDiv").hide()}else{$("#thirdLineDiv").show();$("#thirdLineDivLandscape").hide()}},highLightPhone:function(a){var b="#phonePic";if(a.id=="phoneButtonLandscape")b="#phonePicLandscape";var c=$(b).attr("class").replace("poi_details_call_icon_unfocused","poi_details_call_icon_focused");$(b).attr("class",
c);highlightBtnAll(a,"clsPhoneNoColor","clsPhoneNoColorHL");disHighlightBtnAll(a,"clsPhoneBtnBgNormal","clsPhoneBtnBgHL");CommonUtil.isScoutStyle()&&$("#phonePicCallForScout").attr("class","call_icon_focused")},dishighLightPhone:function(a){var b="#phonePic";if(a.id=="phoneButtonLandscape")b="#phonePicLandscape";var c=$(b).attr("class").replace("poi_details_call_icon_focused","poi_details_call_icon_unfocused");$(b).attr("class",c);disHighlightBtnAll(a,"clsPhoneNoColorHL","clsPhoneNoColor");disHighlightBtnAll(a,
"clsPhoneBtnBgHL","clsPhoneBtnBgNormal");CommonUtil.isScoutStyle()&&$("#phonePicCallForScout").attr("class","call_icon_unfocused")},highLightNavButton:function(a){var b=$("#navImg").attr("class").replace("poi_details_driveto_icon_unfocused","poi_details_driveto_icon_focused");$("#navImg").attr("class",b);switchHightlight(a,"clsNavButtonBgNormal","clsNavButtonBgHL");switchHightlight(a,"clsNavFontColor","clsNavFontColorHL")},dishighLightNavButton:function(a){var b=$("#navImg").attr("class").replace("poi_details_driveto_icon_focused",
"poi_details_driveto_icon_unfocused");$("#navImg").attr("class",b);switchHightlight(a,"clsNavButtonBgHL","clsNavButtonBgNormal");switchHightlight(a,"clsNavFontColorHL","clsNavFontColor")},generateTabs:function(a){hasTabNum=a.length;for(var b=0,c=0,d="",e=0;e<a.length;e++){b=this.getTabWidth(a[e][1],hasTabNum);d+=e==0?this.createTab(b,a[e][0],a[e][1],"On",c,hasTabNum):this.createTab(b,a[e][0],a[e][1],"Off",c,hasTabNum);c++}d+="<div class='td'>&nbsp;</div>";$("#tabShow").html(d)},addTab:function(a,
b,c,d){var e=a.length;if(b&&e<4)a[e]=[c,d]},createTab:function(a,b,c,d,e,g){var f="";f+='<div class="td clsTabOutSideTable '+a+'">';f+='<div style="width:100%;" class="table clsTabInSideTable clsFixTable">';f+="<div class=\"tr\" onClick=\"PoiCommonHelper.onChangeTab('poidetailtab','"+e+"','"+g+"','"+c+"')\">";f+='<div id="poidetaillefttab'+e+'" height="100%" align="center" class="'+("td clsButtonLeft"+d)+'"> </div>';f+='<div id="poidetailmiddletab'+e+'" height="100%" align="center" class="'+("td clsButtonMiddle"+
d)+'"><span class="fs_middle4Tab fs_middle">'+b+"</span></div>";f+='<div id="poidetailrighttab'+e+'" height="100%" align="center" class="'+("td clsButtonRignt"+d)+'"></div>';f+="</div>";f+="</div>";f+="</div>";return f},getTabWidth:function(a,b){var c="clsPoiTabNormalSmall";if(b<=4)c="clsPoiTabNormal";if("poireview"==a)c="clsPoiTabReview";else if("poigas"==a)c="clsPoiTabGas";else if("poitheater"==a)c="clsPoiTabTheater";if("poiextra"==a&&b>=4)c="clsPoiTabNormalSmall";return c},onChangeTab:function(a,
b,c,d){PopupUtil.hide();for(a=0;a<c;a++)if(a==b){document.getElementById("poidetaillefttab"+b).className="td clsTabEdge clsTabLeftOnBk";document.getElementById("poidetailmiddletab"+b).className="td clsButtonMiddleOn clsTabMiddleOnBk text_cutoff";document.getElementById("poidetailrighttab"+b).className="td clsTabEdge clsTabRightOnBk"}else if(document.getElementById("poidetaillefttab"+a)){document.getElementById("poidetaillefttab"+a).className="td clsTabEdge clsTabLeftOffBk";document.getElementById("poidetailmiddletab"+
a).className="td clsButtonMiddleOff clsTabMiddleOffBk text_cutoff";document.getElementById("poidetailrighttab"+a).className="td clsTabEdge clsTabRightOffBk"}hideAll();$("#"+d).show();eval("show"+d)()},showpoideals:function(){var a="",b=CommonUtil.getValidString(PoiCacheHelper.getPoiDealCache());if(""!=b){b=JSON.parse(b);if(b.success){b=JSON.parse(b.deals);for(var c=b.length,d=0;d<c;d++)a+=this.getDealDiv(b[d].name,b[d].description,b[d].dealImage);if(c==0)a+=this.getDealDiv("",I18NHelper["poidetail.dataUnavailable"]);
else recordMisLog_ViewCoupon()}}$("#poideals").html(a)},displayPoiMenu:function(){var a="";a=CommonUtil.getValidString(PoiCacheHelper.getPoiMenuCache());if(""!=a){recordMisLog_ViewMenu();a=JSON.parse(a);var b=a.menu;if(""!=b)$("#poimenu").html(b);else{$("#menuImageDiv").width();$("#clsPadding");$("#menuImageDiv").width();$("#clsPadding");$("#poimenu").html("");""!=a.menuImage?$("#poimenu").html('<image id="{0}" src="{1}" />'.format("menuImage","data:image/png;base64,"+a.menuImage)):$("#poimenu").html(I18NHelper["poidetail.menuUnavailable"])}}},
getDealDiv:function(a,b,c){a="<div class='clsDealItemDiv'><div class='clsDealTitleDiv fs_large fw_bold fc_black'>"+a+"</div><div class='clsDealInfoDiv fs_small fc_gray'>"+b+"</div>";if(c)a+="<div class='clsDealInfoDiv'><img id='dealImage' src='"+c+"'/></div>";a+="</div>";return a},getAdSourceImageClass:function(a){var b="";if(""!=a){if(a=="TN"&&$("#programCode").val()=="SCOUTPROG")a="Scout";b=a+"_logo"}return b},formatPoiDesc:function(a){return a=a.replace(/[&]{1}/g,"&amp;")},getAdsId:function(a){var b=
"";if(a.poi){b=CommonUtil.getValidString(a.poi.adsId);a=a.poi.ad;if((""==b||"0"==b)&&a)b=CommonUtil.getValidString(a.adID)}return b},fetchPoiMainFromServer:function(){loadPopup_poidetail();var a=PoiDetailSpecificHelper.getSearchCriteriaForAds();a={loadingStyle:2,url:GLOBAL_hostUrl+"getPoiDetailData.do?operateType=mainnew&jsonStr="+JSON.stringify(a)+"&"+CommonUtil.getClientInfo(),onSuccess:this.ajaxCallBackPoiMainFromServer};CommonUtil.ajax(a)},ajaxCallBackPoiMainFromServer:function(a){PoiDetailSpecificHelper.handlePoiMainFromServer(a)}};
var PoiCommonHelper=new PoiCommon;var MisLogConstants={EVENT_ID_VBB_INITIAL_VIEW_CLICK:783,EVENT_ID_VBB_INITIAL_VIEW_END:785,EVENT_ID_VBB_DETAIL_VIEW_DRIVETO:788,EVENT_ID_VBB_DETAIL_VIEW_MOREINFO_CLICK:789,EVENT_ID_VBB_POI_VIEW_END:791,EVENT_ID_VBB_POI_VIEW_DRIVETO:792,EVENT_ID_VBB_POI_VIEW_CALLTO:793,EVENT_ID_VBB_POI_VIEW_DEAL:794,EVENT_ID_VBB_POI_VIEW_MENU:795,EVENT_ID_VBB_POI_VIEW_MAP:796,EXIT_REASON_DRIVE_TO:5,EXIT_REASON_MAP:6};
function recordVbbMisLog_Initial_View_Click(){recordMisLogOfVbb(MisLogConstants.EVENT_ID_VBB_INITIAL_VIEW_CLICK)}function recordVbbMisLog_Detail_View_DriveTo(){recordMisLogOfVbb(MisLogConstants.EVENT_ID_VBB_DETAIL_VIEW_DRIVETO)}function recordVbbMisLog_Detail_View_End(a,b){recordMisLogOfVbb2(MisLogConstants.EVENT_ID_VBB_INITIAL_VIEW_END,a,b)}function recordVbbMisLog_Detail_View_MoreInfo_Click(){recordMisLogOfVbb(MisLogConstants.EVENT_ID_VBB_DETAIL_VIEW_MOREINFO_CLICK)}
function recordMisLog_DriveTo_internal(){recordMisLogOfVbb(MisLogConstants.EVENT_ID_VBB_POI_VIEW_DRIVETO)}function recordMisLog_Poi_View_End(a,b){recordMisLogOfVbb2(MisLogConstants.EVENT_ID_VBB_POI_VIEW_END,a,b)}function recordMisLog_ViewCoupon(){recordMisLogOfVbb(MisLogConstants.EVENT_ID_VBB_POI_VIEW_DEAL)}function recordMisLog_CallTo(){recordMisLogOfVbb(MisLogConstants.EVENT_ID_VBB_POI_VIEW_CALLTO)}function recordMisLog_ViewMenu(){recordMisLogOfVbb(MisLogConstants.EVENT_ID_VBB_POI_VIEW_MENU)}
function recordMisLog_ViewMap_internal(){recordMisLogOfVbb(MisLogConstants.EVENT_ID_VBB_POI_VIEW_MAP)}function getCommonVBBFields(){return{"70002":$("#adId").val(),"70003":$("#hidAdSource").val(),"70001":$("#poiId").val(),"70012":$("#poiType").val()}}function recordMisLogOfVbb(a){SDKAPI.logEvent(a,getCommonVBBFields())}function recordMisLogOfVbb2(a,b,c){var d=getCommonVBBFields();d["70037"]=b;d["70038"]=c;SDKAPI.logEvent(a,d)};function PoiCache(){}
PoiCache.prototype={getAdsDetailCache:function(){return sessionStorage.getItem(this.getAdsDetailCacheKey())},getAdsDetailCacheKey:function(){return"SESSION_STORAGE_ADSDETAILDATA_"+$("#adId").val()},setAdsDetailCache:function(a){sessionStorage.setItem(this.getAdsDetailCacheKey(),a)},removeAdsDetailCache:function(){return sessionStorage.removeItem(this.getAdsDetailCacheKey())},setAdsIdCache:function(a){localStorage.setItem(this.getAdsIdCacheKey(),a)},getAdsIdCacheKey:function(){return"LOCAL_STORAGE_ADS_ID"},getAdsIdCache:function(){return localStorage.getItem(this.getAdsIdCacheKey())},
cleanAdsIdCache:function(){return localStorage.removeItem(this.getAdsIdCacheKey())},setDistanceTextCacheForAds:function(a){localStorage.setItem(this.getDistanceTextCacheKeyForAds(),a)},getDistanceTextCacheForAds:function(){return localStorage.getItem(this.getDistanceTextCacheKeyForAds())},getDistanceTextCacheKeyForAds:function(){return"LOCAL_STORAGE_DISTANCE_TEXT_ADS"},removeDistanceTextCacheForAds:function(){localStorage.removeItem(this.getDistanceTextCacheKeyForAds())},setOpenCloseFlag:function(a){sessionStorage.setItem(this.getOpenCloseFlagCacheKey(),
a)},getOpenCloseFlag:function(){return sessionStorage.getItem(this.getOpenCloseFlagCacheKey())},getOpenCloseFlagCacheKey:function(){return"SESSIONSTORAGE_STORAGE_ADS_OPENCLOSE"},setPoiMainCache:function(a){sessionStorage.setItem(this.getPoiMainCacheKey(),a)},getPoiMainCache:function(){return sessionStorage.getItem(this.getPoiMainCacheKey())},removePoiMainCache:function(){return sessionStorage.removeItem(this.getPoiMainCacheKey())},getPoiMainCacheKey:function(){return"SESSION_STORAGE_POIDATA_MAIN_"+
$("#poikey").val()},setPoiMenuCache:function(a){sessionStorage.setItem(this.getPoiMenuCacheKey(),a)},getPoiMenuCache:function(){return sessionStorage.getItem(this.getPoiMenuCacheKey())},removePoiMenuCache:function(){return sessionStorage.removeItem(this.getPoiMenuCacheKey())},getPoiMenuCacheKey:function(){return"SESSION_STORAGE_ADSDATA_MENU"},setPoiDealCache:function(a){sessionStorage.setItem(this.getPoiDealCacheKey(),a)},getPoiDealCache:function(){return sessionStorage.getItem(this.getPoiDealCacheKey())},
removePoiDealCache:function(){return sessionStorage.removeItem(this.getPoiDealCacheKey())},getPoiDealCacheKey:function(){return"SESSION_STORAGE_ADSDATA_DEAL"}};var PoiCacheHelper=new PoiCache;
