var GLOBAL_optons,Global_needSaveNickName2Client=true;function initAddReview(){var a=getSimplePoiObject();$("#name").html("<b>"+a.brand+"</b>");a=getPoiAddressDisplay(a.stop);$("#address").html(a);fetchReviewOptions()}function getSimplePoiObject(){return JSON.parse(CommonUtil.getFromCache(PoiCacheKeys.SIMPLEPOI))}function getPoiAddressDisplay(a){return a.firstLine+" "+a.city+", "+a.province+" "+a.zip}
function onDeviceReady(){SDKAPI.getPreference(afterGetNickNameFromClient,PreferenceConstants.NICKNAME)}function fetchReviewOptions(){if(GLOBAL_optons=JSON.parse(PoiCacheHelper.getPoiReviewOptionCache()))displayReviewOptions(GLOBAL_optons);else{var a=getSimplePoiObject();a={url:GLOBAL_hostUrl+"poireview.do?operateType=getReviewOptions&jsonStr="+JSON.stringify({poiId:a.poiId,categoryId:a.categoryId})+"&"+CommonUtil.getClientInfo(),onSuccess:ajaxCallBackGetReviewOptions};CommonUtil.ajax(a)}}
function ajaxCallBackGetReviewOptions(a){GLOBAL_optons=a;displayReviewOptions(GLOBAL_optons)}
function displayReviewOptions(a){for(var b=a.length,c="",d=0;d<b;d++){c+='<div class="div_row"><div class="div_cell reviewOptionGap"><span class=\'fs_veryLarge fc_gray fw_bold\'>'+a[d].name+"</span><br>";c+="<input type='hidden' id='isLike"+a[d].id+"' value='-1'></div>";var e=getBadScoreText(a[d].id),f=getGoodScoreText(a[d].id);c+='<div class="div_cell reviewOptionGap" style="width: 20%;" id=\''+a[d].id+"Down'>"+e+'</div><div class="div_cell reviewOptionGap" style="width: 20%;" id=\''+a[d].id+"Up'>"+
f+"</div></div>"}$("#reviewOptionList").html(c)}function getBadScoreText(a){return"<a onclick='score("+a+",0)'><img id='"+(a+"DownUnselected")+"' class='evaluation bad_button_unselected'/><img id='"+(a+"DownSelected")+"' class='evaluation bad_button_selected' style='display:none;'/></a>"}
function getGoodScoreText(a){return"<a onclick='score("+a+",1)'><img id='"+(a+"UpUnselected")+"' class='evaluation good_button_unselected'/><img id='"+(a+"UpSelected")+"' class='evaluation good_button_selected'  style='display:none;' /></a>"}
function score(a,b){var c=a+"Down",d=a+"Up";if(b==0){document.getElementById(c).childNodes[0].setAttribute("onClick","score("+a+",-1)");$("#"+a+"DownSelected").show();$("#"+a+"DownUnselected").hide();$("#"+d).html(getGoodScoreText(a))}else{if(b==1){document.getElementById(d).childNodes[0].setAttribute("onClick","score("+a+",-1)");$("#"+a+"UpSelected").show();$("#"+a+"UpUnselected").hide()}else $("#"+d).html(getGoodScoreText(a));$("#"+c).html(getBadScoreText(a))}$("#isLike"+a).val(b)}
function afterGetNickNameFromClient(a){a=CommonUtil.getValidString(a);if(a=="")$("#userNameInputDiv").show();else{Global_needSaveNickName2Client=false;PoiCacheHelper.setNickName(a);$("#userNameInput").val(a)}}
function addReview(){var a=$("#totalRating").val();if(a==null||a=="0"){CommonUtil.showAlert("",I18NHelper["addreview.no.rating"],I18NHelper["common.button.OK"],"closePopup");return false}a=$("#userNameInput").val();if(!a){$("#userNameInput").val(I18NHelper["nickname.title"]);cssHelper.replaceObjCSSById("userNameInput","fc_black","fc_red");cssHelper.replaceObjCSS("userNameInput","fst_normal","fst_italic");return false}if($("#userNameInput").val()==I18NHelper["nickname.title"])return false;if(Global_needSaveNickName2Client){PoiCacheHelper.setNickName(a);
SDKAPI.setPreference(function(){},PreferenceConstants.NICKNAME,a)}SDKAPI.getSSOToken(processReview,false)}
function processReview(){var a=getSimplePoiObject(),b=PoiCacheHelper.getNickName();b=CommonUtil.toJSONString(b);b=encodeURIComponent(b);var c=$("#totalRating").val(),d=$("#comment").val();d=CommonUtil.toJSONString(d);d=encodeURIComponent(d);var e=GLOBAL_optons.length,f=Array(e);if(GLOBAL_optons!=null)for(var g=0;g<e;g++){var h=GLOBAL_optons[g],i=document.getElementById("isLike"+h.id).value;f[g]={id:h.id,name:h.name,value:i}}e=JSON.stringify(f);a={data:0,loadingStyle:1,url:GLOBAL_hostUrl+"poireview.do?operateType=submit&jsonStr="+
JSON.stringify({reviewerName:b,poiId:a.poiId,categoryId:a.categoryId,rating:c,comments:d,ratingProperties:e})+"&"+CommonUtil.getClientInfo(),onSuccess:createAjaxCallBackReview};navigator.onLine?CommonUtil.ajax(a):CommonUtil.noNetworkError()}function createAjaxCallBackReview(a){JSON.parse(a);getSimplePoiObject();PoiCacheHelper.setPoiReviewCacheForAddReview(a);PoiCacheHelper.removePoiReviewCacheKeyForAddReview();refreshPoiList()}
function refreshPoiList(){try{navigator.tnprivateservice.doPrivateService("Refresh",{isNeedRefresh:true},function(){backToPoiDetail()},function(){CommonUtil.debug("doPrivateService error");backToPoiDetail()})}catch(a){CommonUtil.debug(a);backToPoiDetail()}}function backToPoiDetail(){SDKAPI.goBack()}function cancelReview(){backToPoiDetail()}
function lightStar(a){for(var b,c=1;c<=a;c++){b="#lightStar"+c;$(b).attr("class","full_huge_star_icon_unfocused")}for(c=a+1;c<=5;c++){b="#lightStar"+c;$(b).attr("class","vacancy_huge_star_icon_unfocused")}$("#totalRating").val(a)}function closePopup(){PopupUtil.hide()}function onclickUserNameInput(a){if(Global_needSaveNickName2Client){if(a.value==I18NHelper["nickname.title"]){a.value="";cssHelper.replaceObjCSS(a,"fc_red","fc_black")}cssHelper.replaceObjCSS(a,"fst_italic","fst_normal")}}
function onBlurUserNameInput(a){if(Global_needSaveNickName2Client)a.value||cssHelper.replaceObjCSS(a,"fst_normal","fst_italic")};var PoiCacheKeys={POIDETAIL:"SESSION_STORAGE_POIDETAILDATA",SIMPLEPOI:"SESSION_STORAGE_SIMPLE_POIDETAILDATA",REVIEWDATA:"SESSION_STORAGE_POIREVIEWDATA",REVIEWOPTIONS:"SESSION_STORAGE_POIREVIEWOPTIONS"};function PoiCache(){}
PoiCache.prototype={setLogoImageCache:function(a,b){localStorage.setItem(this.getLogoImageCacheKey(a),b)},getLogoImageCache:function(a){return localStorage.getItem(this.getLogoImageCacheKey(a))},getLogoImageCacheKey:function(a){return"LOCAL_STORAGE_LOGOIMAGE_"+a},setPoiMainCache:function(a){sessionStorage.setItem(this.getPoiMainCacheKey(),a)},getPoiMainCache:function(){return sessionStorage.getItem(this.getPoiMainCacheKey())},removePoiMainCache:function(){return sessionStorage.removeItem(this.getPoiMainCacheKey())},
getPoiMainCacheKey:function(){return"SESSION_STORAGE_POIDATA_MAIN_"+$("#poikey").val()},setPoiMenuCache:function(a){sessionStorage.setItem(this.getPoiMenuCacheKey(),a)},getPoiMenuCache:function(){return sessionStorage.getItem(this.getPoiMenuCacheKey())},removePoiMenuCache:function(){return sessionStorage.removeItem(this.getPoiMenuCacheKey())},getPoiMenuCacheKey:function(){return"SESSION_STORAGE_POIDATA_MENU_"+$("#poikey").val()},setGasByPriceCache:function(a){sessionStorage.setItem(this.getGasByPriceCacheKey(),
a)},getGasByPriceCache:function(){return sessionStorage.getItem(this.getGasByPriceCacheKey())},removeGasByPriceCache:function(){return sessionStorage.removeItem(this.getGasByPriceCacheKey())},getGasByPriceCacheKey:function(){return"SESSION_STORAGE_POIDATA_GASBYPRICE_"+$("#poikey").val()},setPoiDealCache:function(a){sessionStorage.setItem(this.getPoiDealCacheKey(),a)},getPoiDealCache:function(){return sessionStorage.getItem(this.getPoiDealCacheKey())},removePoiDealCache:function(){return sessionStorage.removeItem(this.getPoiDealCacheKey())},
getPoiDealCacheKey:function(){return"SESSION_STORAGE_POIDATA_DEAL_"+$("#poikey").val()},setPoiExtraCache:function(a){sessionStorage.setItem(this.getPoiExtraCacheKey(),a)},getPoiExtraCache:function(){return sessionStorage.getItem(this.getPoiExtraCacheKey())},removePoiExtraCache:function(){return sessionStorage.removeItem(this.getPoiExtraCacheKey())},getPoiExtraCacheKey:function(){return"SESSION_STORAGE_POIDATA_EXTRA_"+$("#poikey").val()},setCurrentReviewer:function(a){sessionStorage.setItem(this.getCurrentReviewerCacheKey(),
a)},removeCurrentReviewerCache:function(){return sessionStorage.removeItem(this.getCurrentReviewerCacheKey())},getCurrentReviewer:function(){return sessionStorage.getItem(this.getCurrentReviewerCacheKey())},getCurrentReviewerCacheKey:function(){return"SESSION_STORAGE_REVIEWE_CURRENTREVIEWER"},setNickName:function(a){sessionStorage.setItem(this.getNickNameCacheKey(),a)},getNickName:function(){return sessionStorage.getItem(this.getNickNameCacheKey())},getNickNameCacheKey:function(){return"SESSIONSTORAGE_STORAGE_NICKNAME"},
getDummyPoiDetail:function(){var a="",b=document.getElementById("dummyTemplate").value;b={data:0,url:GLOBAL_hostUrl+"dummyDataAction.do?poi="+b,isAsynchronous:false};b.onSuccess=function(c){a=c};CommonUtil.ajax(b);return a},getReviewStatusCacheKey:function(){return"SESSIONSTORAGE_STORAGE_REVIEWSTATUS_"+$("#poikey").val()},getReviewStatus:function(){return sessionStorage.getItem(this.getReviewStatusCacheKey())},setReviewStatusAsView:function(){this.setReviewStatus("VIEW")},setReviewStatus:function(a){sessionStorage.setItem(this.getReviewStatusCacheKey(),
a)},setPoiReviewCacheKeyForAddReview:function(){sessionStorage.setItem("SESSIONSTORAGE_STORAGE_POI_REVIEW_CACHEKEY_FOR_ADDREVIEW",appendPoiKey(PoiCacheKeys.REVIEWDATA))},getPoiReviewCacheKeyForAddReview:function(){return sessionStorage.getItem("SESSIONSTORAGE_STORAGE_POI_REVIEW_CACHEKEY_FOR_ADDREVIEW")},setPoiReviewOptionCache:function(a){sessionStorage.setItem(PoiCacheKeys.REVIEWOPTIONS,a)},getPoiReviewOptionCache:function(){return sessionStorage.getItem(PoiCacheKeys.REVIEWOPTIONS)},removePoiReviewCacheKeyForAddReview:function(){sessionStorage.removeItem("SESSIONSTORAGE_STORAGE_POI_REVIEW_CACHEKEY_FOR_ADDREVIEW")},
setPoiReviewCacheForAddReview:function(a){sessionStorage.setItem(this.getPoiReviewCacheKeyForAddReview(),a)},setMapFlag:function(a){sessionStorage.setItem(this.getMapFlagCacheKey(),a)},removeMapFlagCache:function(){return sessionStorage.removeItem(this.getMapFlagCacheKey())},getMapFlag:function(){return sessionStorage.getItem(this.getMapFlagCacheKey())},getMapFlagCacheKey:function(){return"SESSIONSTORAGE_STORAGE_MAPFLAG_"+$("#poikey").val()},setBizHourFlag:function(a){sessionStorage.setItem(this.getBizHourFlagCacheKey(),
a)},removeBizHourFlagCache:function(){return sessionStorage.removeItem(this.getBizHourFlagCacheKey())},getBizHourFlag:function(){return sessionStorage.getItem(this.getBizHourFlagCacheKey())},getBizHourFlagCacheKey:function(){return"SESSIONSTORAGE_STORAGE_BIZHOURFLAG_"+$("#poikey").val()}};var PoiCacheHelper=new PoiCache;function initReviewerPage(a){var b=a.ratingProperties,c=CommonUtil.convertChar(a.reviewerName);c||(c=I18NHelper["review.anonymous"]);$("#reviewerName").html(c);diplayRatingIcon("ratingImg",a.rating,"big");(a=(a=CommonUtil.convertChar(a.comments))?a.replace(/\n/g,"<br>"):a)||(a=I18NHelper["review.no.Comment"]);$("#reviewComment").html(a);if(b!=null){var d="<div class='div_table clsFixTable'>",e=0;$.each(b,function(){e++});var f="100%";if(e!=0)f=100/e-1+"%";var g=0;$.each(b,function(h,i){d+="<div class='div_cell'  style='width:"+
f+"' ><div class='div_table align_center'><div class='div_row'><div class='div_cell fs_small fc_gray fw_bold'>"+h+"</div></div><div class='div_row'><div class='div_cell' id='valueImage'>";d+=reviewNum2ReviewImg(i);d+="</div></div>";d+="<div class='div_row'><div class='div_cell align_center fs_small fc_gray' id='reviewOptionValue'>"+reviewNum2ReviewStr(i)+"</div></div>";d+="</div></div>";if(g!=e-1)d+="<div class='div_cell halvingLine'></div>";g++});d+="</div>";$("#reviewOptions").html(d)}else $("#reviewOptions").css("height",
0)}function reviewNum2ReviewStr(a){return a>0?I18NHelper["review.like"]:I18NHelper["review.dislike"]}function reviewNum2ReviewImg(a){return a>0?"<img class='evaluation good_icon_unfocused'  />":"<img class='evaluation bad_icon_unfocused'  />"}function initReviewerData(){var a=JSON.parse(PoiCacheHelper.getCurrentReviewer());a!=null&&initReviewerPage(a)};function getRatingIcons(a,b){var c="";c+="<img class='"+getRatingIconName(a,b)+"'/>";c+="<img class='"+getRatingIconName(a-10,b)+"'/>";c+="<img class='"+getRatingIconName(a-20,b)+"'/>";c+="<img class='"+getRatingIconName(a-30,b)+"'/>";c+="<img class='"+getRatingIconName(a-40,b)+"'/>";return c}function getRatingIconName(a,b){var c="vacancy_",d="full_";c+=b+"_star_icon_unfocused";d+=b+"_star_icon_unfocused";return 0>=a?c:a<10?c:d}function diplayRatingIcon(a,b,c){$("#"+a).html(getRatingIcons(b,c))};
