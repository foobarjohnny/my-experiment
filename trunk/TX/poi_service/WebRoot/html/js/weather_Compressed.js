function Weather(a){this.daylight=a}
Weather.prototype={init:function(){var a=document.getElementById("changeLocationIcon");a.addEventListener("touchstart",function(){this.className="change_location_button_focused"},false);a.addEventListener("touchend",function(){this.className="change_location_button_unfocused"},false);$("#changeLocationIcon").click(SDKAPI.captureAddress)},getSearchLocation:function(){return sessionStorage.getItem("SESSION_STORAGE_WEATHER_SEARCH_LOCATION")},setSearchLocation:function(a){sessionStorage.setItem("SESSION_STORAGE_WEATHER_SEARCH_LOCATION",a)},
refreshData:function(){SDKAPI.getCurrentLocation(this.getGPSBack)},getGPSBack:function(a){CommonUtil.debug("captureAddress: "+JSON.stringify(a));a=CommonUtil.processGpsLocation(a);Weather.preprocessWeather(a)},preprocessWeather:function(a){Weather.setSearchLocation(JSON.stringify(a));Weather.setDaylight(a);SDKAPI.getPreference(this.afterGetDistnaceUnit,PreferenceConstants.DISUNIT)},afterGetDistnaceUnit:function(a){CommonUtil.debug("distanceUnit get from client: "+a);Weather.processWeather(a)},processWeather:function(a){var c=
this.getSearchLocation();ClientInfo.platform=="TNVIEW_LINUX"?PopupUtil.showLoading():PopupUtil.show("loadingPopup","");a={url:GLOBAL_hostUrl+"WeatherFetch.do?addressString="+c+"&distanceUnit="+a+"&"+CommonUtil.getClientInfo(),loadingStyle:1,onSuccess:this.ajaxCallBack,onError:this.ajaxErrCallBack,timeout:7E3};navigator.onLine?CommonUtil.ajax(a):CommonUtil.noNetworkError()},formateCityName:function(a){a=a.city.toLowerCase();return a=a.replace(/\b(\w)|\s(\w)/g,function(c){return c.toUpperCase()})},
ajaxCallBack:function(a){Weather.displayData(a)},ajaxErrCallBack:function(){CommonUtil.noNetworkError()},displayData:function(a){var c=JSON.parse(a.today);a=JSON.parse(a.weekList);var d=c.unit,h=d.charAt(0);$("#title").html(c.titleWithoutState);$("#temp").html(c.temp+d);$("#todayDate").html("<b>"+c.todayDate+"</b>");$("#status").html(c.status);d=c.imageWeatherBig.toString().replace(".png","");if(hasNightImage&&!this.daylight)d+="_night";d="weatherBig "+d;$("#imageWeatherBig").html("<img class='"+
d+"' />");$("#feel").html(c.feel);$("#wind").html(c.wind);$("#humidity").html(c.humidity+"%");var f=0;d=a.length-1;if(c.shortWeekDesc==a[0].shortWeekDesc){$("#highLabel").html("<b>"+a[0].high+h+"</b> ");$("#lowLabel").html(a[0].low+h);f=1;d=a.length}c="<div class='div_table clsWeekly'>";for(var b=0;f<d;f++){var e=a[f].imageWeatherSmall.toString().replace(".png","");if(hasNightImage&&!this.daylight)e+="_night";e="weatherSmall "+e;var g="clsWeatherItem"+b;b++;c+="<div class='div_row weatherBarDiv' ><div class='div_cell weatherBar'></div><div class='div_cell weatherBar'></div><div class='div_cell weatherBar'></div></div><div class='div_row "+
g+"'><div class='div_cell align_left weekAlign'><b class='fs_veryLarge'>"+a[f].shortWeekDesc+"</b></div><div class='div_cell align_center'><img class='"+e+"' /></div><div class='div_cell align_center'><span><b class='fs_veryLarge'> "+a[f].high+h+"</b></span><span><b class='clsScoutGray fs_veryLarge'> "+a[f].low+h+"</b></span></div></div>"}c+="</div>";$("#weeklyWeatherDiv").html(c)},getExitFlag:function(){var a=true;if("true"==CommonUtil.getRequest().animation)a=false;CommonUtil.debug("exitWebView:"+
a);return a},isDaylight:function(a,c,d){if(a&&c&&d){a=new SunriseSunset(d.getFullYear(),d.getMonth()+1,d.getDate(),a,c);d=d.getUTCHours()+(d.getUTCMinutes()*60+d.getUTCSeconds())/3600;return a.isDaylight(d)}return true},setDaylight:function(a){this.daylight=this.isDaylight(a.lat/1E5,a.lon/1E5,new Date)}};Weather=new Weather;function SDK_API_captureAddressCallBack(a){if(a.city)a.city=Weather.formateCityName(a);Weather.preprocessWeather(a)}
function SunriseSunset(a,c,d,h,f){this.zenith=90+50/60;this.utcFullYear=a;this.utcMonth=c;this.utcDay=d;this.latitude=h;this.longitude=f;this.rising=true;this.lngHour=this.longitude/15;this.sin=function(b){return Math.sin(b*Math.PI/180)};this.cos=function(b){return Math.cos(b*Math.PI/180)};this.tan=function(b){return Math.tan(b*Math.PI/180)};this.asin=function(b){return 180/Math.PI*Math.asin(b)};this.acos=function(b){return 180/Math.PI*Math.acos(b)};this.atan=function(b){return 180/Math.PI*Math.atan(b)};
this.getDOY=function(){var b=this.utcMonth,e=this.utcFullYear;return Math.floor(275*b/9)-Math.floor((b+9)/12)*(1+Math.floor((e-4*Math.floor(e/4)+2)/3))+this.utcDay-30};this.approximateTime=function(){var b=this.getDOY();return this.rising?b+(6-this.lngHour)/24:b+(18-this.lngHour)/24};this.meanAnomaly=function(){return 0.9856*this.approximateTime()-3.289};this.trueLongitude=function(){var b=this.meanAnomaly();return(b+1.916*this.sin(b)+0.02*this.sin(2*b)+282.634)%360};this.rightAscension=function(){var b=
this.trueLongitude(),e=this.atan(0.91764*this.tan(b));e%=360;e+=Math.floor(b/90)*90-Math.floor(e/90)*90;e/=15;return e};this.sinDec=function(){return 0.39782*this.sin(this.trueLongitude())};this.cosDec=function(){return this.cos(this.asin(this.sinDec()))};this.localMeanTime=function(){var b=(this.cos(this.zenith)-this.sinDec()*this.sin(this.latitude))/(this.cosDec()*this.cos(this.latitude));if(b>1)return"the sun never rises on this location (on the specified date)";else if(b<-1)return"the sun never sets on this location (on the specified date)";
else{b=this.rising?360-this.acos(b):this.acos(b);b/=15;var e=this.rightAscension(),g=this.approximateTime();return b+e-0.06571*g-6.622}};this.UTCTime=function(){return(this.localMeanTime()-this.lngHour)%24};this.sunriseUtcHours=function(){this.rising=true;return this.UTCTime()};this.sunsetUtcHours=function(){this.rising=false;return this.UTCTime()};this.hoursRange=function(b){return b>=24?b-24:b<0?b+24:b};this.sunriseLocalHours=function(b){return this.hoursRange(b+this.sunriseUtcHours())};this.sunsetLocalHours=
function(b){return this.hoursRange(b+this.sunsetUtcHours())};this.isDaylight=function(b){var e=this.hoursRange(this.sunriseUtcHours()),g=this.hoursRange(this.sunsetUtcHours());if(b<e&&b<g&&e>g)return true;if(b>=e){if(g<e)return true;return b<g}return false}};
