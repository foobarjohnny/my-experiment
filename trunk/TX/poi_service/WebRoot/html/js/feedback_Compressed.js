function onDeviceReady(){Feedback.fetchData();SDKAPI.getPreference(Feedback.setEmail,PreferenceConstants.EMAIL);SDKAPI.getSSOToken(Feedback.setSsoToken,false);var a=Feedback.pageName;if(a){a={type:a};Feedback.dummyData?Feedback.setMockPoiData():SDKAPI.invokePrivateService("getPoiDataForFeedback",a,Feedback.setPoiData);Feedback.showQuestionKey()}if(CommonUtil.isIphone()||ClientInfo.version.match("^7.2"))SDKAPI.getPreference(Feedback.setClientVersion,"internalVersion")}
function Feedback(){this.dummyData=false;this.questionKey=this.questionPre=this.questionID=this.preItemId=this.currentLocation=this.clientVersion=this.ssoToken=this.email=this.pageName="";this.poiData={};this.feedbackData={}}
Feedback.prototype={constructor:Feedback,init:function(){$("#saveButton").click(this.collectData);$("#togglerButton").click(this.clickToggleButton);var a=CommonUtil.getRequest(),c=a.jsp;this.pageName=c?c:"";if(a.dummyData){Feedback.dummyData=true;onDeviceReady();$("#title").click(function(){location.reload(true)})}},setSsoToken:function(a){Feedback.ssoToken=a?a:"";CommonUtil.debug("ssoToken: "+a)},setEmail:function(a){Feedback.email=a?a:"";document.getElementById("emailAddress").value=a;CommonUtil.debug("email: "+
Feedback.email)},setClientVersion:function(a){Feedback.clientVersion=a?a:"";CommonUtil.debug("clientVersion: "+a)},setLocation:function(a){if(a){Feedback.currentLocation=CommonUtil.processGpsLocation(a);CommonUtil.debug("currentLocation: "+JSON.stringify(Feedback.currentLocation))}},setPoiData:function(a){CommonUtil.debug("poi data :  "+a);if(a){a=JSON.parse(a);var c={};if(Feedback.pageName=="poilist"){c.searchKeyword=decodeURI(a.keyword);c.searchCatName=decodeURI(a.categoryName)}else{c.poiId=a.poiId;
c.poiName=decodeURI(a.poiName);c.poiPhoneNumber=a.poiPhoneNumber}c.location=a.stop;Feedback.poiData=c}},setMockPoiData:function(){var a={};if(this.pageName=="poilist"){a.searchKeyword="KFC";a.searchCatName="Food"}else{a.poiId=1;a.poiName="Starbuck Cofee";a.poiPhoneNumber="1234567890"}a.location=JSON.stringify({lat:3761386,lon:-12239382});this.poiData=a},fetchData:function(){var a=GLOBAL_hostUrl+"ajaxFeedback.do?jsp="+this.pageName+"&"+CommonUtil.getClientInfo();CommonUtil.debug("request: "+a);a={loadingStyle:1,
url:a,onSuccess:this.show};$("#loading-overlay").hide();navigator.onLine?CommonUtil.ajax(a):CommonUtil.noNetworkError()},show:function(a){CommonUtil.debug("response: "+JSON.stringify(a));Feedback.questionID=a.questionID;Feedback.questionPre=a.question;a=a.choices;$("#questionContent").html(Feedback.questionPre);Feedback.pageName?Feedback.showPoiFB(a):Feedback.showGeneralFB(a)},showGeneralFB:function(a){for(var c="",d="",b=0;b<2;b++){var e="div_table clsFixTable clsOptionBgNormal clsFontColor_gray ";
switch(b){case 0:e+="clsFeedbackBgTop";break;case 1:e+="clsFeedbackBgBottom"}c+='\t\t<div  id="optionDiv'+b+'" class="'+e+'" onclick="Feedback.changeImg('+b+')" ontouchstart="Feedback.highLightOptionItem('+b+')" ontouchend="Feedback.dishighLightOptionItem('+b+')" ontouchmove="Feedback.dishighLightOptionItem('+b+')">\t\t\t<div class="div_cell checkboxContent">\t\t\t\t<label class="fs_middle" id="op'+b+'">'+a[b]+'</label>\t\t\t</div>\t\t\t<div class="div_cell align_right checkboxImg">\t\t\t\t<input class="clsCheckBox" type="checkbox" id="option'+
b+'" name="feedbacks" />\t\t\t\t<img class="check_box_unfocused" id="image'+b+'"/>\t\t\t</div>\t\t</div>'}for(b=2;b<a.length;b++){e="div_table clsFixTable clsOptionBgNormal clsFontColor_gray ";switch(b){case 2:e+="clsFeedbackBgTop";break;case a.length-1:e+="clsFeedbackBgBottom";break;default:e+="clsFeedbackBgMiddle"}d+='\t\t<div  id="optionDiv'+b+'" class="'+e+'" onclick="Feedback.changeImg('+b+')" ontouchstart="Feedback.highLightOptionItem('+b+')" ontouchend="Feedback.dishighLightOptionItem('+b+
')" ontouchmove="Feedback.dishighLightOptionItem('+b+')">\t\t\t<div class="div_cell checkboxContent">\t\t\t\t<label class="fs_middle" id="op'+b+'">'+a[b]+'</label>\t\t\t</div>\t\t\t<div class="div_cell align_right checkboxImg">\t\t\t\t<input class="clsCheckBox" type="checkbox" id="option'+b+'" name="feedbacks" />\t\t\t\t<img class="check_box_unfocused" id="image'+b+'"/>\t\t\t</div>\t\t</div>'}$("#mainOptionsDiv").html(c);$("#optionListDiv").html(d);SDKAPI.getCurrentLocation(this.setLocation)},showPoiFB:function(a){for(var c=
"",d=0;d<a.length;d++){var b="div_table clsFixTable clsOptionBgNormal clsFontColor_gray ";switch(d){case 0:b+="clsFeedbackBgTop";break;case a.length-1:b+="clsFeedbackBgBottom";break;default:b+="clsFeedbackBgMiddle"}c+='\t\t<div  id="optionDiv'+d+'" class="'+b+'" onclick="Feedback.changeImg('+d+')" ontouchstart="Feedback.highLightOptionItem('+d+')" ontouchend="Feedback.dishighLightOptionItem('+d+')" ontouchmove="Feedback.dishighLightOptionItem('+d+')">\t\t\t<div class="div_cell checkboxContent">\t\t\t\t<label class="fs_middle" id="op'+
d+'">'+a[d]+'</label>\t\t\t</div>\t\t\t<div class="div_cell align_right checkboxImg">\t\t\t\t<input class="clsCheckBox" type="checkbox" id="option'+d+'" name="feedbacks" />\t\t\t\t<img class="check_box_unfocused" id="image'+d+'"/>\t\t\t</div>\t\t</div>'}$("#optionListDiv").html(c)},showQuestionKey:function(){var a="";a=this.pageName=="poilist"?this.poiData.searchKeyword+" ?":this.poiData.poiName+" ?";$("#questionKey").html(a);this.questionKey=a},clickToggleButton:function(){var a=document.getElementById("togglerCheckBox");
if(a.checked){$("#togglerButton").attr("class","toggler_button_OFF");a.checked=false;$("#emailDiv").hide();$("#toggleDiv").attr("class","div_table clsFeedbackBg clsOptionBgNormal")}else{$("#togglerButton").attr("class","toggler_button_ON");a.checked=true;$("#emailDiv").css({display:"table"});$("#toggleDiv").attr("class","div_table clsFeedbackBgTop clsOptionBgNormal")}},collectData:function(){var a=Feedback,c="",d=a.pageName;c=d?a.questionPre+" "+a.questionKey:a.questionPre;for(var b=CommonUtil.getValidString($("#comment").val()),
e=[],g=0,h=document.getElementsByName("feedbacks"),f=0;f<h.length;f++)if(h[f].checked){e[g]=$("#op"+f).html();g++}if(e.length==0&&b==""){CommonUtil.showAlert("",I18NHelper["poi.feedback.selectFeedback"],I18NHelper["common.button.OK"]);return false}c={pageName:a.pageName,questionID:a.questionID,clientVersion:a.clientVersion,email:a.email,question:c,feedbacks:JSON.stringify(e),comments:b,userAgent:navigator.userAgent};b=a.poiData;e=a.currentLocation;if(d){c.location=b.location;if(d=="poilist"){c.searchCatName=
b.searchCatName;c.searchKeyword=b.searchKeyword}else if(d=="poidetail"){c.poiName=b.poiName;c.poiPhoneNumber=b.poiPhoneNumber;c.poiID=b.poiID}}else c.currentLocation=e;d=CommonUtil.getValidString($("#emailAddress").val());CommonUtil.debug("email inputed: "+d);c.email=d;a.feedbackData=c;CommonUtil.debug("feedbackData: "+JSON.stringify(a.feedbackData));if(document.getElementById("togglerCheckBox").checked)if(d)CommonUtil.emailAddressCheck(d)?Feedback.save():CommonUtil.showAlert("",I18NHelper["poi.feedback.invalidEmail"],
I18NHelper["common.button.OK"]);else Feedback.showConfirmPopup(I18NHelper["poi.feedback.hearBack"],"Feedback.onClickSkip",I18NHelper["common.button.Skip"],"Feedback.onClickBack",I18NHelper["common.button.OK"]);else Feedback.save()},save:function(){this.getSdCardLogFlag()?this.showConfirmPopup(I18NHelper["poi.feedback.submitLog"],"Feedback.onClickNo",I18NHelper["common.No"],"Feedback.onClickYes",I18NHelper["common.Yes"]):this.submit()},submit:function(){var a=encodeURIComponent(JSON.stringify(this.feedbackData));
a=GLOBAL_hostUrl+"feedbackSave.do?jsonStr="+a+"&"+CommonUtil.getClientInfo();CommonUtil.debug("ajaxUrl: "+decodeURIComponent(a));a={data:0,loadingStyle:1,url:a,onSuccess:this.submitSuccess};navigator.onLine&&CommonUtil.ajax(a)},submitSuccess:function(){var a='<div class="div_table confirmContent"><div class="div_cell fs_large fc_gray align_center">'+I18NHelper["poi.feedback.submitSuccess"]+"</div></div>";$("#submitSuccessPopup").html(a);PopupUtil.show("submitSuccessPopup","backgroundPopup");setTimeout(Feedback.onClickOK,
3E3)},changeImg:function(a){var c=document.getElementById("option"+a);if(c.checked){document.getElementById("image"+a).className="check_box_unfocused";c.checked=false}else{document.getElementById("image"+a).className="check_box_focused";c.checked=true}},showConfirmPopup:function(a,c,d,b,e){$("#emailConfirmPopup").html('<div class="fdpopupdiv align_center"><div class="div_table confirmContent"><div class="div_cell fs_large fc_gray">'+a+'</div></div></div><div class="popbottomdivstyle"><div class="div_table align_center"><div class="div_cell" style="width:50%"> <button class="confirmButton clsMiddleRadius clsButtonColorNormal clsButtonBgNormal" ontouchstart="highlightBtnAll(this,\'clsButtonColorNormal\',\'clsButtonColorHighlight\')" ontouchend="disHighlightBtnAll(this,\'clsButtonColorHighlight\',\'clsButtonColorNormal\')" ontouchmove="disHighlightBtnAll(this,\'clsButtonColorHighlight\',\'clsButtonColorNormal\')" onClick="'+
c+'()"><span class="fs_large">'+d+'</span></button></div><div class="div_cell" style="width:50%"> <button class="confirmButton clsMiddleRadius clsButtonColorNormal clsButtonBgNormal" ontouchstart="highlightBtnAll(this,\'clsButtonColorNormal\',\'clsButtonColorHighlight\')" ontouchend="disHighlightBtnAll(this,\'clsButtonColorHighlight\',\'clsButtonColorNormal\')" ontouchmove="disHighlightBtnAll(this,\'clsButtonColorHighlight\',\'clsButtonColorNormal\')" onClick="'+b+'()"><span class="fs_large">'+e+
"</span></button></div></div></div>");PopupUtil.show("emailConfirmPopup","backgroundPopup")},onClickOK:function(){PopupUtil.hide();SDKAPI.goBack(true)},onClickSkip:function(){PopupUtil.hide();this.save()},onClickBack:function(){PopupUtil.hide();for(var a=document.getElementById("emailAddress"),c=a.offsetTop;a=a.offsetParent;)c+=a.offsetTop;window.scrollTo(0,c)},onClickYes:function(){PopupUtil.hide();SDKAPI.invokePrivateService("submitSdCardLog");this.submit()},onClickNo:function(){PopupUtil.hide();
this.submit()},getSdCardLogFlag:function(){return"true"==CommonUtil.getRequest().needSdCardLog?true:false},highLightOptionItem:function(a){this.dishighLightOptionItem(this.preItemId);this.preItemId=a;a=document.getElementById("optionDiv"+a);switchHightlight(a,"clsOptionBgNormal","clsButtonBgHighlight");switchHightlight(a,"clsFontColor_gray","clsFontColor_white")},dishighLightOptionItem:function(a){a=document.getElementById("optionDiv"+a);switchHightlight(a,"clsButtonBgHighlight","clsOptionBgNormal");
switchHightlight(a,"clsFontColor_white","clsFontColor_gray")}};Feedback=new Feedback;
