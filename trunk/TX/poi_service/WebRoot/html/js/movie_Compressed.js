function onClickDatePrevious(){if(getDaysDiff(GLOBAL_todayDate,GLOBAL_searchDate)>0){GLOBAL_searchDate.setDate(GLOBAL_searchDate.getDate()-1);changeDatePickerStatus()}}function changeDatePickerStatus(){changeDateDisplay();datePickerOnDateChange()}
function changeDateDisplay(){var a=getDaysDiff(GLOBAL_todayDate,GLOBAL_searchDate);if(a==0)changeDatePreviousStyle(false);else if(a==GLOBAL_dateMaxRange)changeDateNextStyle(false);else{changeDatePreviousStyle(true);changeDateNextStyle(true)}setSearchDateDisplay(a)}function onClickDateNext(){if(getDaysDiff(GLOBAL_todayDate,GLOBAL_searchDate)<GLOBAL_dateMaxRange){GLOBAL_searchDate.setDate(GLOBAL_searchDate.getDate()+1);changeDatePickerStatus()}}
function setSearchDateDisplay(a){a=a==0?I18NHelper["mSearch.today"]:GLOBAL_searchDate.format("ddd, mmm d");document.getElementById("searchDate").innerText=a}function getDaysDiff(a,b){var c=new Date(a),e=new Date(b);c.setHours(0,0,1,0);e.setHours(0,0,1,0);c=e.getTime()-c.getTime();return parseInt(c/864E5)}
function changeDatePreviousStyle(a){if(a){document.getElementById("datePrevious").href="javascript:onClickDatePrevious()";$("#datePreviousIcon").attr("class","date_previous_button_unfocused")}else{document.getElementById("datePrevious").href="javascript:void(0)";$("#datePreviousIcon").attr("class","date_previous_button_disabled")}}
function changeDateNextStyle(a){if(a){document.getElementById("dateNext").href="javascript:onClickDateNext()";$("#dateNextIcon").attr("class","date_next_button_unfocused")}else{document.getElementById("dateNext").href="javascript:void(0)";$("#dateNextIcon").attr("class","date_next_button_disabled")}}
function switchDatePreviousIcon(a){var b=true;if($("#datePrevious").attr("href")=="javascript:void(0)")b=false;if(b)a?$("#datePreviousIcon").attr("class","date_previous_button_focused"):$("#datePreviousIcon").attr("class","date_previous_button_unfocused")}function switchDateNextIcon(a){var b=true;if($("#dateNext").attr("href")=="javascript:void(0)")b=false;if(b)a?$("#dateNextIcon").attr("class","date_next_button_focused"):$("#dateNextIcon").attr("class","date_next_button_unfocused")};function fetchMovieListData(){var a={theaterId:JSON.parse(CommonUtil.getFromCache(appendPoiKey(PoiCacheKeys.POIDETAIL))).poi.bizPoi.poiId,dateIndex:getSearchDateText()};a=getHostUrlOfMovie()+"lookUpMovie.do?jsonStr="+JSON.stringify(a)+"&"+CommonUtil.getClientInfo();console.log(a);CommonUtil.ajax({data:0,url:a,loadingStyle:2,onSuccess:ajaxCallBackMovieList})}function getHostUrlOfMovie(){return getServerURL(GLOBAL_serverUrl)+"/movie/html/"}
function ajaxCallBackMovieList(a){var b=JSON.parse(a);if(b.length>0){b=b[0].theaterId;var c=JSON.parse(CommonUtil.getFromCache(appendPoiKey(PoiCacheKeys.POIDETAIL))).poi,e=c.stop;b=new TheaterItem(b,c.bizPoi.brand,e.firstLine+"<br/>"+e.city+", "+e.province+" "+e.zip);setCurrentTheater(JSON.stringify(b));displayMovieList(a)}else noRecordFoundForMovie()}
function noRecordFoundForMovie(){var a="<div class='clsMovieItemBg'><table width='100%' height='10%' border='0' cellspacing='0' cellpadding='0' style='font-size:1em;'><tr height='100%' style='cursor:pointer' align='left'><td class='clsMovieItemStyle fs_middle' >"+I18NHelper["poidetail.dataUnavailable"]+"</td></tr></table></div>";document.getElementById("movieList").innerHTML=a}
function initMovieShowTimes(){GLOBAL_searchDate=new Date;GLOBAL_todayDate=new Date;setSearchDateOfShowTime(GLOBAL_searchDate);$("#searchDate").html(I18NHelper["mSearch.today"]);changeDatePreviousStyle(false);changeDateNextStyle(true)}function datePickerOnDateChange(){setSearchDateOfShowTime(GLOBAL_searchDate);loadPopup_poidetail();fetchMovieListData()}
function onClickBuy(a,b,c,e){var d=$("#movieName-"+a).val();d=new MovieItem(a,d);setCurrentMoive(JSON.stringify(d));setScheduleDate(GLOBAL_searchDate);setSearchDateOfShowTime(GLOBAL_searchDate);a=new ScheduleItem(a,b,c,e);setCurrentSchedule(JSON.stringify(a));forwardToBuyTicket()}function forwardToBuyTicket(){var a=getHostUrlOfMovie()+"goToJsp.do?jsp=showSchedule&"+CommonUtil.getClientInfo()+"&exitWebView=true";SDKAPI.launchLocalApp(a)}function MovieItem(a,b){this.id=a;this.name=b}
function TheaterItem(a,b,c){this.id=a;this.name=b;this.addressDisplay=c}function ScheduleItem(a,b,c,e){this.movieId=a;this.theaterId=b;this.showTimes=c;this.ticketURI=e}function setCurrentTheater(a){localStorage.setItem(getCurrentTheaterCacheKey(),a)}function getCurrentTheater(){return localStorage.getItem(getCurrentTheaterCacheKey())}function setCurrentMoive(a){localStorage.setItem(getCurrentMovieCacheKey(),a)}function setCurrentSchedule(a){localStorage.setItem(getCurrentScheduleCacheKey(),a)}
function getCurrentMovie(){return localStorage.getItem(getCurrentMovieCacheKey())}function getCurrentTheaterCacheKey(){return"LOCAL_STORAGE_CURRENTTHEATER"}function getCurrentMovieCacheKey(){return"LOCAL_STORAGE_CURRENTMOVIE"}function getCurrentScheduleCacheKey(){return"LOCAL_STORAGE_CURRENTSCHEDULE"}function setScheduleDate(a){a=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate();localStorage.setItem("LOCAL_STORAGE_SCHEDULE_DATE",a)}
function getServerURL(a){var b=a.indexOf("/",7);return a.substring(0,b)}
function displayMovieList(a){a=JSON.parse(a);for(var b="",c,e=0;e<a.length;e++){c=a[e];b+="<div class='clsMovieItemBg clsListBgNormal'><div class='table clsMovieItemStyle clsFontColor_gray fs_small' style='width:100%;table-layout:fixed;'><div class='tr'><div class='td clsEllipsis'>"+c.name+"</div></div></div>";if(null!=c.scheduleItem){b+="<div class='table clsShowTime'>";b+="<div class='tr'><div class='td clsMovieItemStyle clsFontColor_gray fs_smallest' style='width:75%;'>"+getFormatedShowTimes(c.scheduleItem.showTimes)+
"</div>";if(null!=c.scheduleItem.ticketURI&&CommonUtil.getBoolean(FeatureHelper.MOVIE_BUY))b+="<div class='td clsButtonLocation' align='center'><input type='button' class='clsBuyButton fs_middle fw_bold clsBuyButtonBk' value='"+I18NHelper["buy.msg"]+"' onClick=\"onClickBuy('"+c.id+"','"+c.theaterId+"','"+c.scheduleItem.showTimes+"','"+c.scheduleItem.ticketURI+"')\" /></div>";b+="</div></div>"}b+="</div><input type='hidden' id='movieName-"+c.id+"' value=\""+c.name+'" />'}document.getElementById("movieList").innerHTML=
b}function getFormatedShowTimes(a){if(""==a)return"";var b=(new Date).format("HH:MM:ss");a=a.split(";");for(var c,e=false,d="",g=a.length,j,f=getDaysDiff(new Date,getSearchDate()),i=0;i<g;i++){c=compareTime(a[i],b);j=convertTimeFormatToDisplay(a[i]);if(c<=0&&f==0)d+="<SPAN class='lineThroughText'>"+j+"</SPAN>";else if(e)d+=j;else{e=true;d+="<SPAN class='clsFontColor_blue'>"+j+"</SPAN>"}if(i!=g-1)d+=" | "}return d}
function convertTimeFormatToDisplay(a){a=a.split(":");var b=a[0]%24,c="";if(b==0)c="12:"+a[1]+"am";else if(b==12)c="12:"+a[1]+"pm";else if(b<12)c=b+":"+a[1]+"am";else{b-=12;c=b+":"+a[1]+"pm"}return c}function compareTime(a,b){var c=0,e=milOfTime(a),d=milOfTime(b);if(e>d)c=1;else if(d>e)c=-1;return c}function milOfTime(a){var b=a.split(":");a=parseInt(b[0],10);b=parseInt(b[1],10);return(new Date(2007,0,1,a,b,0)).getTime()}
function getDaysDiff(a,b){var c=new Date(a),e=new Date(b);c.setHours(0,0,1,0);e.setHours(0,0,1,0);c=e.getTime()-c.getTime();return parseInt(c/864E5)}function getSearchDate(){var a=localStorage.getItem("LOCAL_STORAGE_SEARCH_DATE").split("-"),b=new Date;b.setFullYear(parseInt(a[0]),parseInt(a[1])-1,parseInt(a[2]));b.setHours(0,0,1,0);return b}function setSearchDateOfShowTime(a){a=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate();localStorage.setItem("LOCAL_STORAGE_SEARCH_DATE",a)}
function getSearchDateText(){var a=getSearchDate();return a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()}function highLightScheduleItem(a){switchHightlight(a,"clsListBgNormal","clsListBgHighlight");switchHightlight(a,"clsFontColor_gray","clsFontColor_white")}function dishighLightScheduleItem(a){switchHightlight(a,"clsListBgHighlight","clsListBgNormal");switchHightlight(a,"clsFontColor_white","clsFontColor_gray")};var dateFormat=function(){var a=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,b=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,c=/[^-+\dA-Z]/g,e=function(d,g){d=String(d);for(g=g||2;d.length<g;)d="0"+d;return d};return function(d,g,j){var f=$("#locale").val();f=="de_DE"||f=="en_GB"||f=="en_US"||f=="ne_ES"||f=="es_MX"||f=="fr_FR"||f=="it_IT"||f=="nl_NL"||f=="pt_BR"||(f="en_US");var i=dateFormat;
if(arguments.length==1&&Object.prototype.toString.call(d)=="[object String]"&&!/\d/.test(d)){g=d;d=undefined}d=d?new Date(d):new Date;if(isNaN(d))throw SyntaxError("invalid date");g=String(i.masks[g]||g||i.masks["default"]);if(g.slice(0,4)=="UTC:"){g=g.slice(4);j=true}var h=j?"getUTC":"get",l=d[h+"Date"](),p=d[h+"Day"](),m=d[h+"Month"](),q=d[h+"FullYear"](),k=d[h+"Hours"](),r=d[h+"Minutes"](),s=d[h+"Seconds"]();h=d[h+"Milliseconds"]();var o=j?0:d.getTimezoneOffset(),t={d:l,dd:e(l),ddd:i.i18n["dayNames_"+
f][p],dddd:i.i18n["dayNames_"+f][p+7],m:m+1,mm:e(m+1),mmm:i.i18n["monthNames_"+f][m],mmmm:i.i18n["monthNames_"+f][m+12],yy:String(q).slice(2),yyyy:q,h:k%12||12,hh:e(k%12||12),H:k,HH:e(k),M:r,MM:e(r),s:s,ss:e(s),l:e(h,3),L:e(h>99?Math.round(h/10):h),t:k<12?"a":"p",tt:k<12?"am":"pm",T:k<12?"A":"P",TT:k<12?"AM":"PM",Z:j?"UTC":(String(d).match(b)||[""]).pop().replace(c,""),o:(o>0?"-":"+")+e(Math.floor(Math.abs(o)/60)*100+Math.abs(o)%60,4),S:["th","st","nd","rd"][l%10>3?0:(l%100-l%10!=10)*l%10]};return g.replace(a,
function(n){return n in t?t[n]:n.slice(1,n.length-1)})}}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};
dateFormat.i18n={dayNames_en_US:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames_en_US:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],dayNames_es_ES:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames_es_ES:["Jan",
"Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],dayNames_de_DE:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames_de_DE:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],
dayNames_en_GB:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames_en_GB:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],dayNames_es_MX:["Do","Lu","Ma","Mi","Ju","Vi","S\u00e1","Domingo","Lunes","Martes","Mi\u00e9rcoles","Jueves","Viernes","S\u00e1bado"],monthNames_es_MX:["Ene","Feb","Mar",
"Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic","Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],dayNames_fr_FR:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames_fr_FR:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],dayNames_it_IT:["Sun",
"Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames_it_IT:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],dayNames_nl_NL:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames_nl_NL:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug",
"Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],dayNames_pt_BR:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames_pt_BR:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};
Date.prototype.format=function(a,b){return dateFormat(this,a,b)};
